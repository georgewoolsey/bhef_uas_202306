<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Local DBH to Height Model | Black Hills Experimental Forest UAS Mission Data Summary</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Local DBH to Height Model | Black Hills Experimental Forest UAS Mission Data Summary" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Local DBH to Height Model | Black Hills Experimental Forest UAS Mission Data Summary" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data_prep.html"/>
<link rel="next" href="exploratory-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/elev. (ft)_f97124-1/data_stars_elevft01e6af.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/canopy ht. (ft)_da071c-1/data_stars_canopyhtfta20165.txt"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="objective.html"><a href="objective.html"><i class="fa fa-check"></i><b>2</b> Objective</a></li>
<li class="chapter" data-level="3" data-path="data_prep.html"><a href="data_prep.html"><i class="fa fa-check"></i><b>3</b> Data Preparation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data_prep.html"><a href="data_prep.html#data-load"><i class="fa fa-check"></i><b>3.1</b> Data Load</a></li>
<li class="chapter" data-level="3.2" data-path="data_prep.html"><a href="data_prep.html#load-orthomosaic-rasters"><i class="fa fa-check"></i><b>3.2</b> Load orthomosaic rasters</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="local_mod.html"><a href="local_mod.html"><i class="fa fa-check"></i><b>4</b> Local DBH to Height Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="local_mod.html"><a href="local_mod.html#random-forest-model"><i class="fa fa-check"></i><b>4.1</b> Random Forest Model</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="local_mod.html"><a href="local_mod.html#training-vs-non-training-dbh"><i class="fa fa-check"></i><b>4.1.1</b> Training vs Non-Training DBH</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="local_mod.html"><a href="local_mod.html#linear-model"><i class="fa fa-check"></i><b>4.2</b> Linear Model</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="local_mod.html"><a href="local_mod.html#model-parameter-estimates"><i class="fa fa-check"></i><b>4.2.1</b> Model Parameter Estimates</a></li>
<li class="chapter" data-level="4.2.2" data-path="local_mod.html"><a href="local_mod.html#sfm-derived-height-to-dbh-allometry"><i class="fa fa-check"></i><b>4.2.2</b> SfM-derived Height to DBH Allometry</a></li>
<li class="chapter" data-level="4.2.3" data-path="local_mod.html"><a href="local_mod.html#training-vs-non-training-dbh-1"><i class="fa fa-check"></i><b>4.2.3</b> Training vs Non-Training DBH</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="local_mod.html"><a href="local_mod.html#quadratic-model"><i class="fa fa-check"></i><b>4.3</b> Quadratic Model</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="local_mod.html"><a href="local_mod.html#model-parameter-estimates-1"><i class="fa fa-check"></i><b>4.3.1</b> Model Parameter Estimates</a></li>
<li class="chapter" data-level="4.3.2" data-path="local_mod.html"><a href="local_mod.html#sfm-derived-height-to-dbh-allometry-1"><i class="fa fa-check"></i><b>4.3.2</b> SfM-derived Height to DBH Allometry</a></li>
<li class="chapter" data-level="4.3.3" data-path="local_mod.html"><a href="local_mod.html#training-vs-non-training-dbh-2"><i class="fa fa-check"></i><b>4.3.3</b> Training vs Non-Training DBH</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="local_mod.html"><a href="local_mod.html#no-intercept-quadratic-model"><i class="fa fa-check"></i><b>4.4</b> No Intercept Quadratic Model</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="local_mod.html"><a href="local_mod.html#model-parameter-estimates-2"><i class="fa fa-check"></i><b>4.4.1</b> Model Parameter Estimates</a></li>
<li class="chapter" data-level="4.4.2" data-path="local_mod.html"><a href="local_mod.html#sfm-derived-height-to-dbh-allometry-2"><i class="fa fa-check"></i><b>4.4.2</b> SfM-derived Height to DBH Allometry</a></li>
<li class="chapter" data-level="4.4.3" data-path="local_mod.html"><a href="local_mod.html#training-vs-non-training-dbh-3"><i class="fa fa-check"></i><b>4.4.3</b> Training vs Non-Training DBH</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="local_mod.html"><a href="local_mod.html#nonlinear-power-model"><i class="fa fa-check"></i><b>4.5</b> Nonlinear Power Model</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="local_mod.html"><a href="local_mod.html#model-parameter-estimates-3"><i class="fa fa-check"></i><b>4.5.1</b> Model Parameter Estimates</a></li>
<li class="chapter" data-level="4.5.2" data-path="local_mod.html"><a href="local_mod.html#sfm-derived-height-to-dbh-allometry-3"><i class="fa fa-check"></i><b>4.5.2</b> SfM-derived Height to DBH Allometry</a></li>
<li class="chapter" data-level="4.5.3" data-path="local_mod.html"><a href="local_mod.html#training-vs-non-training-dbh-4"><i class="fa fa-check"></i><b>4.5.3</b> Training vs Non-Training DBH</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="local_mod.html"><a href="local_mod.html#nonlinear-weibull-model"><i class="fa fa-check"></i><b>4.6</b> Nonlinear Weibull Model</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="local_mod.html"><a href="local_mod.html#model-parameter-estimates-4"><i class="fa fa-check"></i><b>4.6.1</b> Model Parameter Estimates</a></li>
<li class="chapter" data-level="4.6.2" data-path="local_mod.html"><a href="local_mod.html#sfm-derived-height-to-dbh-allometry-4"><i class="fa fa-check"></i><b>4.6.2</b> SfM-derived Height to DBH Allometry</a></li>
<li class="chapter" data-level="4.6.3" data-path="local_mod.html"><a href="local_mod.html#training-vs-non-training-dbh-5"><i class="fa fa-check"></i><b>4.6.3</b> Training vs Non-Training DBH</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="local_mod.html"><a href="local_mod.html#model-comparison"><i class="fa fa-check"></i><b>4.7</b> Model Comparison</a></li>
<li class="chapter" data-level="4.8" data-path="local_mod.html"><a href="local_mod.html#update-dbh-to-best-model"><i class="fa fa-check"></i><b>4.8</b> Update DBH to best model</a></li>
<li class="chapter" data-level="4.9" data-path="local_mod.html"><a href="local_mod.html#combine-harvest-units-with-tree-locations"><i class="fa fa-check"></i><b>4.9</b> Combine harvest units with tree locations</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html"><i class="fa fa-check"></i><b>5</b> Exploratory Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#study-location-map"><i class="fa fa-check"></i><b>5.1</b> Study Location Map</a></li>
<li class="chapter" data-level="5.2" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#digital-terrain-model-dtm-map"><i class="fa fa-check"></i><b>5.2</b> Digital Terrain Model (DTM) Map</a></li>
<li class="chapter" data-level="5.3" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#canopy-height-model-chm-map"><i class="fa fa-check"></i><b>5.3</b> Canopy height model (CHM) Map</a></li>
<li class="chapter" data-level="5.4" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#dbh-distribution"><i class="fa fa-check"></i><b>5.4</b> DBH Distribution</a></li>
<li class="chapter" data-level="5.5" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#height-distribution"><i class="fa fa-check"></i><b>5.5</b> Height Distribution</a></li>
<li class="chapter" data-level="5.6" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#relationship-between-height-and-dbh"><i class="fa fa-check"></i><b>5.6</b> Relationship between height and DBH</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ostory_valid.html"><a href="ostory_valid.html"><i class="fa fa-check"></i><b>6</b> Overstory Field Validation Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ostory_valid.html"><a href="ostory_valid.html#load-field-data"><i class="fa fa-check"></i><b>6.1</b> Load Field Data</a></li>
<li class="chapter" data-level="6.2" data-path="ostory_valid.html"><a href="ostory_valid.html#build-uas-field-validation-data"><i class="fa fa-check"></i><b>6.2</b> Build UAS-Field Validation Data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ostory_valid.html"><a href="ostory_valid.html#true-positive-identification"><i class="fa fa-check"></i><b>6.2.1</b> True Positive Identification</a></li>
<li class="chapter" data-level="6.2.2" data-path="ostory_valid.html"><a href="ostory_valid.html#combine-with-commission-and-omission"><i class="fa fa-check"></i><b>6.2.2</b> Combine with Commission and Omission</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ostory_valid.html"><a href="ostory_valid.html#summary-of-validation-data"><i class="fa fa-check"></i><b>6.3</b> Summary of Validation Data</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="ostory_valid.html"><a href="ostory_valid.html#true-positive-commission-ommission"><i class="fa fa-check"></i><b>6.3.1</b> True Positive, Commission, Ommission</a></li>
<li class="chapter" data-level="6.3.2" data-path="ostory_valid.html"><a href="ostory_valid.html#f-score"><i class="fa fa-check"></i><b>6.3.2</b> F-score</a></li>
<li class="chapter" data-level="6.3.3" data-path="ostory_valid.html"><a href="ostory_valid.html#height-vs.-dbh-of-tp-co-om"><i class="fa fa-check"></i><b>6.3.3</b> Height vs. DBH of <span class="math inline">\(Tp\)</span>, <span class="math inline">\(Co\)</span>, <span class="math inline">\(Om\)</span></a></li>
<li class="chapter" data-level="6.3.4" data-path="ostory_valid.html"><a href="ostory_valid.html#height-and-dbh-distribution-tp-co-om"><i class="fa fa-check"></i><b>6.3.4</b> Height and DBH Distribution <span class="math inline">\(Tp\)</span>, <span class="math inline">\(Co\)</span>, <span class="math inline">\(Om\)</span></a></li>
<li class="chapter" data-level="6.3.5" data-path="ostory_valid.html"><a href="ostory_valid.html#detected-overstory-tp-height-difference"><i class="fa fa-check"></i><b>6.3.5</b> Detected Overstory (<span class="math inline">\(TP\)</span>) Height Difference</a></li>
<li class="chapter" data-level="6.3.6" data-path="ostory_valid.html"><a href="ostory_valid.html#detected-overstory-tp-dbh-difference"><i class="fa fa-check"></i><b>6.3.6</b> Detected Overstory (<span class="math inline">\(TP\)</span>) DBH Difference</a></li>
<li class="chapter" data-level="6.3.7" data-path="ostory_valid.html"><a href="ostory_valid.html#detected-overstory-tp-reliability"><i class="fa fa-check"></i><b>6.3.7</b> Detected Overstory (<span class="math inline">\(TP\)</span>) Reliability</a></li>
<li class="chapter" data-level="6.3.8" data-path="ostory_valid.html"><a href="ostory_valid.html#detected-overstory-tp-distribution-comparison"><i class="fa fa-check"></i><b>6.3.8</b> Detected Overstory (<span class="math inline">\(TP\)</span>) Distribution Comparison</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="ostory_valid.html"><a href="ostory_valid.html#commission-and-omission-locations"><i class="fa fa-check"></i><b>6.4</b> Commission and Omission Locations</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="ostory_valid.html"><a href="ostory_valid.html#othomosaic-commission-and-omission-locations"><i class="fa fa-check"></i><b>6.4.1</b> Othomosaic Commission and Omission Locations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ustory_valid.html"><a href="ustory_valid.html"><i class="fa fa-check"></i><b>7</b> Regeneration Field Validation Data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ustory_valid.html"><a href="ustory_valid.html#load-field-data-1"><i class="fa fa-check"></i><b>7.1</b> Load Field Data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ustory_valid.html"><a href="ustory_valid.html#regeneration-field-data-plot-map"><i class="fa fa-check"></i><b>7.1.1</b> Regeneration Field Data Plot Map</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ustory_valid.html"><a href="ustory_valid.html#create-data-to-compare-to-uas"><i class="fa fa-check"></i><b>7.2</b> Create Data to Compare to UAS</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ustory_valid.html"><a href="ustory_valid.html#field-regeneration-tpa-by-size-class"><i class="fa fa-check"></i><b>7.2.1</b> Field Regeneration TPA by Size Class</a></li>
<li class="chapter" data-level="7.2.2" data-path="ustory_valid.html"><a href="ustory_valid.html#stand-regeneration-tpa-map"><i class="fa fa-check"></i><b>7.2.2</b> Stand Regeneration TPA Map</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ustory_valid.html"><a href="ustory_valid.html#uas-estimated-regeneration"><i class="fa fa-check"></i><b>7.3</b> UAS Estimated Regeneration</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="ustory_valid.html"><a href="ustory_valid.html#uas-vs-field-regneration-tpa-by-size-class"><i class="fa fa-check"></i><b>7.3.1</b> UAS vs Field Regneration TPA by Size Class</a></li>
<li class="chapter" data-level="7.3.2" data-path="ustory_valid.html"><a href="ustory_valid.html#uas-vs-field-regeneration-tpa-by-stand"><i class="fa fa-check"></i><b>7.3.2</b> UAS vs Field Regeneration TPA by Stand</a></li>
<li class="chapter" data-level="7.3.3" data-path="ustory_valid.html"><a href="ustory_valid.html#uas-vs-field-regeneration-tpa-in-sample-plots"><i class="fa fa-check"></i><b>7.3.3</b> UAS vs Field Regeneration TPA in Sample Plots</a></li>
<li class="chapter" data-level="7.3.4" data-path="ustory_valid.html"><a href="ustory_valid.html#uas-vs-field-regeneration-tpa-correlation"><i class="fa fa-check"></i><b>7.3.4</b> UAS vs Field Regeneration TPA Correlation</a></li>
<li class="chapter" data-level="7.3.5" data-path="ustory_valid.html"><a href="ustory_valid.html#uas-regeneration-tpa-reliability"><i class="fa fa-check"></i><b>7.3.5</b> UAS Regeneration TPA Reliability</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="silv.html"><a href="silv.html"><i class="fa fa-check"></i><b>8</b> Silvicultural Metrics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="silv.html"><a href="silv.html#overstory-summary"><i class="fa fa-check"></i><b>8.1</b> Overstory Summary</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="silv.html"><a href="silv.html#distribution-of-silvicultural-metrics"><i class="fa fa-check"></i><b>8.1.1</b> Distribution of silvicultural metrics</a></li>
<li class="chapter" data-level="8.1.2" data-path="silv.html"><a href="silv.html#overstory-stand-basal-area-map"><i class="fa fa-check"></i><b>8.1.2</b> Overstory Stand Basal Area Map</a></li>
<li class="chapter" data-level="8.1.3" data-path="silv.html"><a href="silv.html#stand-qmd-map"><i class="fa fa-check"></i><b>8.1.3</b> Stand QMD Map</a></li>
<li class="chapter" data-level="8.1.4" data-path="silv.html"><a href="silv.html#overstory-dbh-distrubtion"><i class="fa fa-check"></i><b>8.1.4</b> Overstory DBH Distrubtion</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="silv.html"><a href="silv.html#height-distribution-1"><i class="fa fa-check"></i><b>8.2</b> Height Distribution</a></li>
<li class="chapter" data-level="8.3" data-path="silv.html"><a href="silv.html#understory-summary"><i class="fa fa-check"></i><b>8.3</b> Understory Summary</a></li>
<li class="chapter" data-level="8.4" data-path="silv.html"><a href="silv.html#define-functions-for-stand-summary"><i class="fa fa-check"></i><b>8.4</b> Define Functions for Stand Summary</a></li>
<li class="chapter" data-level="8.5" data-path="silv.html"><a href="silv.html#harvest-unit-summary-reports"><i class="fa fa-check"></i><b>8.5</b> Harvest Unit Summary Reports</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tree_spatial.html"><a href="tree_spatial.html"><i class="fa fa-check"></i><b>9</b> UAS Tree Spatial Arrangement</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Black Hills Experimental Forest UAS Mission Data Summary</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="local_mod" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Section 4</span> Local DBH to Height Model<a href="local_mod.html#local_mod" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="random-forest-model" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Random Forest Model<a href="local_mod.html#random-forest-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The UAS point cloud <a href="https://github.com/georgewoolsey/point_cloud_tree_detection_ex/blob/da5c8a13e9b2f2914b306201605e907643b3006d/src/point_cloud_processing.R">processing script</a> used a random forest model to estimate tree DBH based on the sample of DBH values extracted from the point cloud (outlined in detail <a href="https://georgewoolsey.github.io/point_cloud_tree_detection_ex/#Model_to_estimate_missing_DBHs">here</a>. This random forest model included tree height (m), crown area (m<sup>2</sup>), minimum crown height (m), and local tree competition metrics to estimate missing DBH values. Using methods outlined by <a href="https://scholar.google.com/scholar?cluster=14807895789640069059&amp;hl=en&amp;as_sdt=0,6">Tinkham et al. (2022)</a>, local competition metrics included the distance to the nearest neighbor, trees ha<sup>−1</sup> within a 5 m radius, and the relative tree height within a 5 m radius. A 5 m radius was selected as it represents a distance slightly less than the point at which two mature ponderosa pine trees in the region would begin to have interlocking crowns, representing a proxy for direct competition. The relative tree height within a 5 m radius was estimated using:</p>
<p><span class="math display">\[
\textrm{Relative Height} = \frac{\textrm{Height}}{\textrm{Height}_\textrm{max}} \times 100
\]</span></p>
<p>, where <span class="math inline">\(\textrm{Height}\)</span> is the height of the subject tree and <span class="math inline">\(\textrm{Height}_\textrm{max}\)</span> is the height of the tallest tree within a 5 m radius of the subject tree.</p>
<div id="training-vs-non-training-dbh" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Training vs Non-Training DBH<a href="local_mod.html#training-vs-non-training-dbh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="local_mod.html#cb4-1" tabindex="-1"></a><span class="do">### plot</span></span>
<span id="cb4-2"><a href="local_mod.html#cb4-2" tabindex="-1"></a>plt_rf <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="local_mod.html#cb4-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="local_mod.html#cb4-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="local_mod.html#cb4-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb4-6"><a href="local_mod.html#cb4-6" tabindex="-1"></a>    treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="local_mod.html#cb4-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="local_mod.html#cb4-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="local_mod.html#cb4-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.15</span>)</span>
<span id="cb4-10"><a href="local_mod.html#cb4-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="local_mod.html#cb4-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb4-12"><a href="local_mod.html#cb4-12" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb4-13"><a href="local_mod.html#cb4-13" tabindex="-1"></a>      <span class="at">x=</span>tree_height_m, <span class="at">y =</span> dbh_cm</span>
<span id="cb4-14"><a href="local_mod.html#cb4-14" tabindex="-1"></a>      , <span class="at">color =</span> is_training_data</span>
<span id="cb4-15"><a href="local_mod.html#cb4-15" tabindex="-1"></a>      , <span class="at">fill =</span> is_training_data</span>
<span id="cb4-16"><a href="local_mod.html#cb4-16" tabindex="-1"></a>      , <span class="at">group =</span> is_training_data</span>
<span id="cb4-17"><a href="local_mod.html#cb4-17" tabindex="-1"></a>    )</span>
<span id="cb4-18"><a href="local_mod.html#cb4-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-19"><a href="local_mod.html#cb4-19" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb4-20"><a href="local_mod.html#cb4-20" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb4-21"><a href="local_mod.html#cb4-21" tabindex="-1"></a>    , <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb4-22"><a href="local_mod.html#cb4-22" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb4-23"><a href="local_mod.html#cb4-23" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb4-24"><a href="local_mod.html#cb4-24" tabindex="-1"></a>    , <span class="at">show.legend =</span> F</span>
<span id="cb4-25"><a href="local_mod.html#cb4-25" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb4-26"><a href="local_mod.html#cb4-26" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb4-27"><a href="local_mod.html#cb4-27" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;loess&quot;</span></span>
<span id="cb4-28"><a href="local_mod.html#cb4-28" tabindex="-1"></a>    , <span class="at">se =</span> F</span>
<span id="cb4-29"><a href="local_mod.html#cb4-29" tabindex="-1"></a>    , <span class="at">span =</span> <span class="dv">1</span></span>
<span id="cb4-30"><a href="local_mod.html#cb4-30" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb4-31"><a href="local_mod.html#cb4-31" tabindex="-1"></a>    , <span class="at">show.legend =</span> T</span>
<span id="cb4-32"><a href="local_mod.html#cb4-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-33"><a href="local_mod.html#cb4-33" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-34"><a href="local_mod.html#cb4-34" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-35"><a href="local_mod.html#cb4-35" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb4-36"><a href="local_mod.html#cb4-36" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>tree_height_m)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb4-37"><a href="local_mod.html#cb4-37" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-38"><a href="local_mod.html#cb4-38" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb4-39"><a href="local_mod.html#cb4-39" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb4-40"><a href="local_mod.html#cb4-40" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Random Forest Model&quot;</span></span>
<span id="cb4-41"><a href="local_mod.html#cb4-41" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;SfM-derived tree height and DBH relationship&quot;</span></span>
<span id="cb4-42"><a href="local_mod.html#cb4-42" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb4-43"><a href="local_mod.html#cb4-43" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb4-44"><a href="local_mod.html#cb4-44" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-45"><a href="local_mod.html#cb4-45" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb4-46"><a href="local_mod.html#cb4-46" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-47"><a href="local_mod.html#cb4-47" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb4-48"><a href="local_mod.html#cb4-48" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb4-49"><a href="local_mod.html#cb4-49" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-50"><a href="local_mod.html#cb4-50" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb4-51"><a href="local_mod.html#cb4-51" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb4-52"><a href="local_mod.html#cb4-52" tabindex="-1"></a>  )</span>
<span id="cb4-53"><a href="local_mod.html#cb4-53" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb4-54"><a href="local_mod.html#cb4-54" tabindex="-1"></a>plt_rf</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/plt-rf-1.png" width="1008" /></p>
</div>
</div>
<div id="linear-model" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Linear Model<a href="local_mod.html#linear-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://scholar.google.com/scholar?cluster=14807895789640069059&amp;hl=en&amp;as_sdt=0,6">Tinkham et al. (2022)</a> found the simple linear form resulted in the best estimates for both tree and stand level summarizations:</p>
<p><span class="math display">\[\begin{align*}
DBH_{i}  &amp;\sim {\sf Gamma} \bigl(g(\beta_0, \beta_1, Height_{i}), shape \bigr) \\
g(\beta_0, \beta_1, Height_{i}) &amp;= {\exp \bigl(\beta_0 + \beta_1 \cdot Height_{i}\bigr)} \\
\beta_{0}  &amp;\sim {\sf Normal} (0,10) \\
\beta_{1}  &amp;\sim {\sf Normal} (0,10) \\
shape  &amp;\sim {\sf Gamma} (0.01,0.01)
\end{align*}\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data. The <span class="math inline">\(\sf Gamma\)</span> response distribution represents <span class="math inline">\(DBH_{i}\)</span> as strictly non-negative.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="local_mod.html#cb5-1" tabindex="-1"></a><span class="co"># population model with no random effects (i.e. no group-level variation)</span></span>
<span id="cb5-2"><a href="local_mod.html#cb5-2" tabindex="-1"></a>  <span class="co"># Gamma distribution for strictly positive response variable dbh</span></span>
<span id="cb5-3"><a href="local_mod.html#cb5-3" tabindex="-1"></a>  mod_lin <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb5-4"><a href="local_mod.html#cb5-4" tabindex="-1"></a>    <span class="at">formula =</span> dbh_cm <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> tree_height_m</span>
<span id="cb5-5"><a href="local_mod.html#cb5-5" tabindex="-1"></a>    , <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="local_mod.html#cb5-6" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="local_mod.html#cb5-7" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb5-8"><a href="local_mod.html#cb5-8" tabindex="-1"></a>    , <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">brmsfamily</span>(<span class="st">&quot;Gamma&quot;</span>, <span class="at">link =</span> <span class="st">&quot;identity&quot;</span>)</span>
<span id="cb5-9"><a href="local_mod.html#cb5-9" tabindex="-1"></a>    , <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape))</span>
<span id="cb5-10"><a href="local_mod.html#cb5-10" tabindex="-1"></a>    , <span class="at">iter =</span> <span class="dv">3000</span></span>
<span id="cb5-11"><a href="local_mod.html#cb5-11" tabindex="-1"></a>    , <span class="at">file =</span> <span class="st">&quot;../data/mod_lin&quot;</span></span>
<span id="cb5-12"><a href="local_mod.html#cb5-12" tabindex="-1"></a>  )</span>
<span id="cb5-13"><a href="local_mod.html#cb5-13" tabindex="-1"></a>  <span class="co"># plot(mod_lin)</span></span>
<span id="cb5-14"><a href="local_mod.html#cb5-14" tabindex="-1"></a>  <span class="co"># summary(mod_lin)</span></span>
<span id="cb5-15"><a href="local_mod.html#cb5-15" tabindex="-1"></a>  <span class="co"># plot(brms::conditional_effects(mod_lin), points = T)</span></span>
<span id="cb5-16"><a href="local_mod.html#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="local_mod.html#cb5-17" tabindex="-1"></a>  <span class="co"># compute and save the WAIC information for the next three models</span></span>
<span id="cb5-18"><a href="local_mod.html#cb5-18" tabindex="-1"></a>  mod_lin <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(mod_lin, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb5-19"><a href="local_mod.html#cb5-19" tabindex="-1"></a>  </span>
<span id="cb5-20"><a href="local_mod.html#cb5-20" tabindex="-1"></a>  <span class="co"># predict values over range</span></span>
<span id="cb5-21"><a href="local_mod.html#cb5-21" tabindex="-1"></a>  pred_mod_lin <span class="ot">=</span> <span class="fu">predict</span>(</span>
<span id="cb5-22"><a href="local_mod.html#cb5-22" tabindex="-1"></a>      mod_lin</span>
<span id="cb5-23"><a href="local_mod.html#cb5-23" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb5-24"><a href="local_mod.html#cb5-24" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb5-25"><a href="local_mod.html#cb5-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="local_mod.html#cb5-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-27"><a href="local_mod.html#cb5-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb5-28"><a href="local_mod.html#cb5-28" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb5-29"><a href="local_mod.html#cb5-29" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-30"><a href="local_mod.html#cb5-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb5-31"><a href="local_mod.html#cb5-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-32"><a href="local_mod.html#cb5-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb5-33"><a href="local_mod.html#cb5-33" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>())</span>
<span id="cb5-34"><a href="local_mod.html#cb5-34" tabindex="-1"></a>  </span>
<span id="cb5-35"><a href="local_mod.html#cb5-35" tabindex="-1"></a>  <span class="co"># attach predicted values to original data</span></span>
<span id="cb5-36"><a href="local_mod.html#cb5-36" tabindex="-1"></a>  treetops_sf_with_dbh <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb5-37"><a href="local_mod.html#cb5-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb5-38"><a href="local_mod.html#cb5-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb5-39"><a href="local_mod.html#cb5-39" tabindex="-1"></a>       pred_mod_lin <span class="sc">%&gt;%</span> </span>
<span id="cb5-40"><a href="local_mod.html#cb5-40" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(tree_height_m_tnth, estimate)</span>
<span id="cb5-41"><a href="local_mod.html#cb5-41" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(tree_height_m_tnth)</span>
<span id="cb5-42"><a href="local_mod.html#cb5-42" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-43"><a href="local_mod.html#cb5-43" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-44"><a href="local_mod.html#cb5-44" tabindex="-1"></a>      <span class="at">mod_lin_est_dbh_cm =</span> <span class="fu">ifelse</span>(is_training_data <span class="sc">==</span> T, dbh_cm, estimate)</span>
<span id="cb5-45"><a href="local_mod.html#cb5-45" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-46"><a href="local_mod.html#cb5-46" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(estimate, tree_height_m_tnth))</span>
<span id="cb5-47"><a href="local_mod.html#cb5-47" tabindex="-1"></a>  </span>
<span id="cb5-48"><a href="local_mod.html#cb5-48" tabindex="-1"></a>  <span class="fu">gc</span>()</span></code></pre></div>
<div id="model-parameter-estimates" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Model Parameter Estimates<a href="local_mod.html#model-parameter-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Simple linear form:</p>
<p><span class="math display">\[
DBH_i = \beta_0 + \beta_1 \cdot Height_i
\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="local_mod.html#cb6-1" tabindex="-1"></a><span class="co"># parameter estimates</span></span>
<span id="cb6-2"><a href="local_mod.html#cb6-2" tabindex="-1"></a>mod_lin_sum_temp <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">posterior_summary</span>(mod_lin) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="local_mod.html#cb6-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="local_mod.html#cb6-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="local_mod.html#cb6-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># | parameter == &quot;shape&quot;) %&gt;% </span></span>
<span id="cb6-6"><a href="local_mod.html#cb6-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower)</span>
<span id="cb6-7"><a href="local_mod.html#cb6-7" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb6-8"><a href="local_mod.html#cb6-8" tabindex="-1"></a>mod_lin_sum_temp <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="local_mod.html#cb6-9" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="local_mod.html#cb6-10" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
-3.7689
</td>
<td style="text-align:right;">
0.4497
</td>
<td style="text-align:right;">
-4.6500
</td>
<td style="text-align:right;">
-2.8868
</td>
</tr>
<tr>
<td style="text-align:left;">
b_tree_height_m
</td>
<td style="text-align:right;">
2.3505
</td>
<td style="text-align:right;">
0.0312
</td>
<td style="text-align:right;">
2.2907
</td>
<td style="text-align:right;">
2.4120
</td>
</tr>
</tbody>
</table>
</div>
<div id="sfm-derived-height-to-dbh-allometry" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> SfM-derived Height to DBH Allometry<a href="local_mod.html#sfm-derived-height-to-dbh-allometry" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="local_mod.html#cb7-1" tabindex="-1"></a><span class="co"># plot predictions with data</span></span>
<span id="cb7-2"><a href="local_mod.html#cb7-2" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb7-3"><a href="local_mod.html#cb7-3" tabindex="-1"></a>    <span class="at">data =</span> pred_mod_lin, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tree_height_m)</span>
<span id="cb7-4"><a href="local_mod.html#cb7-4" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-5"><a href="local_mod.html#cb7-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb7-6"><a href="local_mod.html#cb7-6" tabindex="-1"></a>    <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="local_mod.html#cb7-7" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="local_mod.html#cb7-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb7-9"><a href="local_mod.html#cb7-9" tabindex="-1"></a>    , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> dbh_cm)</span>
<span id="cb7-10"><a href="local_mod.html#cb7-10" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span></span>
<span id="cb7-11"><a href="local_mod.html#cb7-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-12"><a href="local_mod.html#cb7-12" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb7-13"><a href="local_mod.html#cb7-13" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">ymin =</span> lower_b, <span class="at">ymax =</span> upper_b)</span>
<span id="cb7-14"><a href="local_mod.html#cb7-14" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;gray88&quot;</span></span>
<span id="cb7-15"><a href="local_mod.html#cb7-15" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb7-16"><a href="local_mod.html#cb7-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-17"><a href="local_mod.html#cb7-17" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb7-18"><a href="local_mod.html#cb7-18" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> estimate)</span>
<span id="cb7-19"><a href="local_mod.html#cb7-19" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span></span>
<span id="cb7-20"><a href="local_mod.html#cb7-20" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb7-21"><a href="local_mod.html#cb7-21" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-22"><a href="local_mod.html#cb7-22" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-23"><a href="local_mod.html#cb7-23" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb7-24"><a href="local_mod.html#cb7-24" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb7-25"><a href="local_mod.html#cb7-25" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Local height to DBH allometry from SfM-extracted DBH samples&quot;</span></span>
<span id="cb7-26"><a href="local_mod.html#cb7-26" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb7-27"><a href="local_mod.html#cb7-27" tabindex="-1"></a>      <span class="st">&quot;$DBH = &quot;</span></span>
<span id="cb7-28"><a href="local_mod.html#cb7-28" tabindex="-1"></a>      , mod_lin_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Intercept&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb7-29"><a href="local_mod.html#cb7-29" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb7-30"><a href="local_mod.html#cb7-30" tabindex="-1"></a>      , mod_lin_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_tree_height_m&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb7-31"><a href="local_mod.html#cb7-31" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height&quot;</span></span>
<span id="cb7-32"><a href="local_mod.html#cb7-32" tabindex="-1"></a>    ))</span>
<span id="cb7-33"><a href="local_mod.html#cb7-33" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-34"><a href="local_mod.html#cb7-34" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb7-35"><a href="local_mod.html#cb7-35" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/mod-lin-pred-1.png" width="1008" /></p>
</div>
<div id="training-vs-non-training-dbh-1" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Training vs Non-Training DBH<a href="local_mod.html#training-vs-non-training-dbh-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="local_mod.html#cb8-1" tabindex="-1"></a><span class="do">### plot</span></span>
<span id="cb8-2"><a href="local_mod.html#cb8-2" tabindex="-1"></a>plt_lin <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="local_mod.html#cb8-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="local_mod.html#cb8-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="local_mod.html#cb8-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb8-6"><a href="local_mod.html#cb8-6" tabindex="-1"></a>    treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="local_mod.html#cb8-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="local_mod.html#cb8-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="local_mod.html#cb8-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.15</span>)</span>
<span id="cb8-10"><a href="local_mod.html#cb8-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="local_mod.html#cb8-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb8-12"><a href="local_mod.html#cb8-12" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb8-13"><a href="local_mod.html#cb8-13" tabindex="-1"></a>      <span class="at">x=</span>tree_height_m, <span class="at">y =</span> mod_lin_est_dbh_cm</span>
<span id="cb8-14"><a href="local_mod.html#cb8-14" tabindex="-1"></a>      , <span class="at">color =</span> is_training_data</span>
<span id="cb8-15"><a href="local_mod.html#cb8-15" tabindex="-1"></a>      , <span class="at">fill =</span> is_training_data</span>
<span id="cb8-16"><a href="local_mod.html#cb8-16" tabindex="-1"></a>      , <span class="at">group =</span> is_training_data</span>
<span id="cb8-17"><a href="local_mod.html#cb8-17" tabindex="-1"></a>    )</span>
<span id="cb8-18"><a href="local_mod.html#cb8-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-19"><a href="local_mod.html#cb8-19" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb8-20"><a href="local_mod.html#cb8-20" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;loess&quot;</span></span>
<span id="cb8-21"><a href="local_mod.html#cb8-21" tabindex="-1"></a>    , <span class="at">se =</span> F</span>
<span id="cb8-22"><a href="local_mod.html#cb8-22" tabindex="-1"></a>    , <span class="at">span =</span> <span class="dv">1</span></span>
<span id="cb8-23"><a href="local_mod.html#cb8-23" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb8-24"><a href="local_mod.html#cb8-24" tabindex="-1"></a>    , <span class="at">show.legend =</span> T</span>
<span id="cb8-25"><a href="local_mod.html#cb8-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-26"><a href="local_mod.html#cb8-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb8-27"><a href="local_mod.html#cb8-27" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb8-28"><a href="local_mod.html#cb8-28" tabindex="-1"></a>    , <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb8-29"><a href="local_mod.html#cb8-29" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb8-30"><a href="local_mod.html#cb8-30" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb8-31"><a href="local_mod.html#cb8-31" tabindex="-1"></a>    , <span class="at">show.legend =</span> F</span>
<span id="cb8-32"><a href="local_mod.html#cb8-32" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb8-33"><a href="local_mod.html#cb8-33" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb8-34"><a href="local_mod.html#cb8-34" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)</span>
<span id="cb8-35"><a href="local_mod.html#cb8-35" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb8-36"><a href="local_mod.html#cb8-36" tabindex="-1"></a>      <span class="st">&quot;$DBH = &quot;</span></span>
<span id="cb8-37"><a href="local_mod.html#cb8-37" tabindex="-1"></a>      , mod_lin_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Intercept&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb8-38"><a href="local_mod.html#cb8-38" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb8-39"><a href="local_mod.html#cb8-39" tabindex="-1"></a>      , mod_lin_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_tree_height_m&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb8-40"><a href="local_mod.html#cb8-40" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height&quot;</span></span>
<span id="cb8-41"><a href="local_mod.html#cb8-41" tabindex="-1"></a>    ))</span>
<span id="cb8-42"><a href="local_mod.html#cb8-42" tabindex="-1"></a>    , <span class="at">parse =</span> T</span>
<span id="cb8-43"><a href="local_mod.html#cb8-43" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb8-44"><a href="local_mod.html#cb8-44" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-45"><a href="local_mod.html#cb8-45" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb8-46"><a href="local_mod.html#cb8-46" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb8-47"><a href="local_mod.html#cb8-47" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb8-48"><a href="local_mod.html#cb8-48" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>tree_height_m)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb8-49"><a href="local_mod.html#cb8-49" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-50"><a href="local_mod.html#cb8-50" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb8-51"><a href="local_mod.html#cb8-51" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb8-52"><a href="local_mod.html#cb8-52" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Linear Model&quot;</span></span>
<span id="cb8-53"><a href="local_mod.html#cb8-53" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;SfM-derived tree height and DBH relationship&quot;</span></span>
<span id="cb8-54"><a href="local_mod.html#cb8-54" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb8-55"><a href="local_mod.html#cb8-55" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb8-56"><a href="local_mod.html#cb8-56" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-57"><a href="local_mod.html#cb8-57" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb8-58"><a href="local_mod.html#cb8-58" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-59"><a href="local_mod.html#cb8-59" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb8-60"><a href="local_mod.html#cb8-60" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb8-61"><a href="local_mod.html#cb8-61" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-62"><a href="local_mod.html#cb8-62" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb8-63"><a href="local_mod.html#cb8-63" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb8-64"><a href="local_mod.html#cb8-64" tabindex="-1"></a>  )</span>
<span id="cb8-65"><a href="local_mod.html#cb8-65" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb8-66"><a href="local_mod.html#cb8-66" tabindex="-1"></a>plt_lin</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/plt-lin-1.png" width="1008" /></p>
</div>
</div>
<div id="quadratic-model" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Quadratic Model<a href="local_mod.html#quadratic-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A quadratic linear model with the inclusion of <span class="math inline">\(Height_{i}^{2}\)</span> in the model allows us to account for a nonlinear (e.g. parabolic) relationship between DBH and tree height.</p>
<p><span class="math display">\[\begin{align*}
DBH_{i}  &amp;\sim {\sf Gamma} \bigl(g(\beta_0, \beta_1, \beta_2, Height_{i}), shape \bigr) \\
g(\beta_0, \beta_1, \beta_2, Height_{i}) &amp;= {\exp \bigl(\beta_0 + \beta_1 \cdot Height_{i} + \beta_2 \cdot Height_{i}^{2}\bigr)} \\
\beta_{0}  &amp;\sim {\sf Normal} (0,10) \\
\beta_{1}  &amp;\sim {\sf Normal} (0,10) \\
\beta_{2}  &amp;\sim {\sf Normal} (0,10) \\
shape  &amp;\sim {\sf Gamma} (0.01,0.01)
\end{align*}\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data. The <span class="math inline">\(\sf Gamma\)</span> response distribution represents <span class="math inline">\(DBH_{i}\)</span> as strictly non-negative.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="local_mod.html#cb9-1" tabindex="-1"></a><span class="co"># population model with no random effects (i.e. no group-level variation)</span></span>
<span id="cb9-2"><a href="local_mod.html#cb9-2" tabindex="-1"></a>  <span class="co"># Gamma distribution for strictly positive response variable dbh</span></span>
<span id="cb9-3"><a href="local_mod.html#cb9-3" tabindex="-1"></a>  mod_quad <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb9-4"><a href="local_mod.html#cb9-4" tabindex="-1"></a>    <span class="at">formula =</span> dbh_cm <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> tree_height_m <span class="sc">+</span> <span class="fu">I</span>(tree_height_m<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-5"><a href="local_mod.html#cb9-5" tabindex="-1"></a>    , <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="local_mod.html#cb9-6" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="local_mod.html#cb9-7" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb9-8"><a href="local_mod.html#cb9-8" tabindex="-1"></a>    , <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">brmsfamily</span>(<span class="st">&quot;Gamma&quot;</span>, <span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb9-9"><a href="local_mod.html#cb9-9" tabindex="-1"></a>    , <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape))</span>
<span id="cb9-10"><a href="local_mod.html#cb9-10" tabindex="-1"></a>    , <span class="at">iter =</span> <span class="dv">3000</span></span>
<span id="cb9-11"><a href="local_mod.html#cb9-11" tabindex="-1"></a>    , <span class="at">file =</span> <span class="st">&quot;../data/mod_quad&quot;</span></span>
<span id="cb9-12"><a href="local_mod.html#cb9-12" tabindex="-1"></a>  )</span>
<span id="cb9-13"><a href="local_mod.html#cb9-13" tabindex="-1"></a>  <span class="co"># plot(mod_quad)</span></span>
<span id="cb9-14"><a href="local_mod.html#cb9-14" tabindex="-1"></a>  <span class="co"># summary(mod_quad)</span></span>
<span id="cb9-15"><a href="local_mod.html#cb9-15" tabindex="-1"></a>  <span class="co"># plot(brms::conditional_effects(mod_quad), points = T)</span></span>
<span id="cb9-16"><a href="local_mod.html#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="local_mod.html#cb9-17" tabindex="-1"></a>  <span class="co"># compute and save the WAIC information for the next three models</span></span>
<span id="cb9-18"><a href="local_mod.html#cb9-18" tabindex="-1"></a>  mod_quad <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(mod_quad, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb9-19"><a href="local_mod.html#cb9-19" tabindex="-1"></a>  </span>
<span id="cb9-20"><a href="local_mod.html#cb9-20" tabindex="-1"></a>  <span class="co"># predict values over range</span></span>
<span id="cb9-21"><a href="local_mod.html#cb9-21" tabindex="-1"></a>  pred_mod_quad <span class="ot">=</span> <span class="fu">predict</span>(</span>
<span id="cb9-22"><a href="local_mod.html#cb9-22" tabindex="-1"></a>      mod_quad</span>
<span id="cb9-23"><a href="local_mod.html#cb9-23" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb9-24"><a href="local_mod.html#cb9-24" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb9-25"><a href="local_mod.html#cb9-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb9-26"><a href="local_mod.html#cb9-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-27"><a href="local_mod.html#cb9-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb9-28"><a href="local_mod.html#cb9-28" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb9-29"><a href="local_mod.html#cb9-29" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-30"><a href="local_mod.html#cb9-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb9-31"><a href="local_mod.html#cb9-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-32"><a href="local_mod.html#cb9-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb9-33"><a href="local_mod.html#cb9-33" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>())</span>
<span id="cb9-34"><a href="local_mod.html#cb9-34" tabindex="-1"></a>  </span>
<span id="cb9-35"><a href="local_mod.html#cb9-35" tabindex="-1"></a>  <span class="co"># attach predicted values to original data</span></span>
<span id="cb9-36"><a href="local_mod.html#cb9-36" tabindex="-1"></a>  treetops_sf_with_dbh <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb9-37"><a href="local_mod.html#cb9-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb9-38"><a href="local_mod.html#cb9-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb9-39"><a href="local_mod.html#cb9-39" tabindex="-1"></a>       pred_mod_quad <span class="sc">%&gt;%</span> </span>
<span id="cb9-40"><a href="local_mod.html#cb9-40" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(tree_height_m_tnth, estimate)</span>
<span id="cb9-41"><a href="local_mod.html#cb9-41" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(tree_height_m_tnth)</span>
<span id="cb9-42"><a href="local_mod.html#cb9-42" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-43"><a href="local_mod.html#cb9-43" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-44"><a href="local_mod.html#cb9-44" tabindex="-1"></a>      <span class="at">mod_quad_est_dbh_cm =</span> <span class="fu">ifelse</span>(is_training_data <span class="sc">==</span> T, dbh_cm, estimate)</span>
<span id="cb9-45"><a href="local_mod.html#cb9-45" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-46"><a href="local_mod.html#cb9-46" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(estimate, tree_height_m_tnth))</span>
<span id="cb9-47"><a href="local_mod.html#cb9-47" tabindex="-1"></a>  </span>
<span id="cb9-48"><a href="local_mod.html#cb9-48" tabindex="-1"></a>  <span class="fu">gc</span>()</span></code></pre></div>
<div id="model-parameter-estimates-1" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Model Parameter Estimates<a href="local_mod.html#model-parameter-estimates-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Quadratic linear model form:</p>
<p><span class="math display">\[
DBH_{i} = \exp\bigl(\beta_0 + \beta_1 \cdot Height_{i} + \beta_2 \cdot Height_{i}^{2} \bigr)
\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="local_mod.html#cb10-1" tabindex="-1"></a><span class="co"># parameter estimates</span></span>
<span id="cb10-2"><a href="local_mod.html#cb10-2" tabindex="-1"></a>mod_quad_sum_temp <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">posterior_summary</span>(mod_quad) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="local_mod.html#cb10-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="local_mod.html#cb10-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="local_mod.html#cb10-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># | parameter == &quot;shape&quot;) %&gt;% </span></span>
<span id="cb10-6"><a href="local_mod.html#cb10-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower)</span>
<span id="cb10-7"><a href="local_mod.html#cb10-7" tabindex="-1"></a>  <span class="co"># dplyr::mutate(</span></span>
<span id="cb10-8"><a href="local_mod.html#cb10-8" tabindex="-1"></a>  <span class="co">#   dplyr::across(.cols = tidyselect::where(is.numeric), .fns = exp)</span></span>
<span id="cb10-9"><a href="local_mod.html#cb10-9" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb10-10"><a href="local_mod.html#cb10-10" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb10-11"><a href="local_mod.html#cb10-11" tabindex="-1"></a>mod_quad_sum_temp <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="local_mod.html#cb10-12" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="local_mod.html#cb10-13" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
1.8837
</td>
<td style="text-align:right;">
0.6399
</td>
<td style="text-align:right;">
1.4717
</td>
<td style="text-align:right;">
3.8981
</td>
</tr>
<tr>
<td style="text-align:left;">
b_tree_height_m
</td>
<td style="text-align:right;">
0.1298
</td>
<td style="text-align:right;">
0.0793
</td>
<td style="text-align:right;">
-0.1194
</td>
<td style="text-align:right;">
0.1807
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Itree_height_mE2
</td>
<td style="text-align:right;">
-0.0018
</td>
<td style="text-align:right;">
0.0024
</td>
<td style="text-align:right;">
-0.0033
</td>
<td style="text-align:right;">
0.0057
</td>
</tr>
</tbody>
</table>
</div>
<div id="sfm-derived-height-to-dbh-allometry-1" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> SfM-derived Height to DBH Allometry<a href="local_mod.html#sfm-derived-height-to-dbh-allometry-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="local_mod.html#cb11-1" tabindex="-1"></a><span class="co"># predict and put estimates in a data frame</span></span>
<span id="cb11-2"><a href="local_mod.html#cb11-2" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb11-3"><a href="local_mod.html#cb11-3" tabindex="-1"></a>      mod_quad</span>
<span id="cb11-4"><a href="local_mod.html#cb11-4" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb11-5"><a href="local_mod.html#cb11-5" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb11-6"><a href="local_mod.html#cb11-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="local_mod.html#cb11-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="local_mod.html#cb11-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb11-9"><a href="local_mod.html#cb11-9" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb11-10"><a href="local_mod.html#cb11-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-11"><a href="local_mod.html#cb11-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb11-12"><a href="local_mod.html#cb11-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="local_mod.html#cb11-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb11-14"><a href="local_mod.html#cb11-14" tabindex="-1"></a><span class="co"># plot predictions with data</span></span>
<span id="cb11-15"><a href="local_mod.html#cb11-15" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb11-16"><a href="local_mod.html#cb11-16" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tree_height_m)</span>
<span id="cb11-17"><a href="local_mod.html#cb11-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-18"><a href="local_mod.html#cb11-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb11-19"><a href="local_mod.html#cb11-19" tabindex="-1"></a>    <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb11-20"><a href="local_mod.html#cb11-20" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-21"><a href="local_mod.html#cb11-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb11-22"><a href="local_mod.html#cb11-22" tabindex="-1"></a>    , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> dbh_cm)</span>
<span id="cb11-23"><a href="local_mod.html#cb11-23" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span></span>
<span id="cb11-24"><a href="local_mod.html#cb11-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-25"><a href="local_mod.html#cb11-25" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb11-26"><a href="local_mod.html#cb11-26" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">ymin =</span> lower_b, <span class="at">ymax =</span> upper_b)</span>
<span id="cb11-27"><a href="local_mod.html#cb11-27" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;gray88&quot;</span></span>
<span id="cb11-28"><a href="local_mod.html#cb11-28" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb11-29"><a href="local_mod.html#cb11-29" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-30"><a href="local_mod.html#cb11-30" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb11-31"><a href="local_mod.html#cb11-31" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> estimate)</span>
<span id="cb11-32"><a href="local_mod.html#cb11-32" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span></span>
<span id="cb11-33"><a href="local_mod.html#cb11-33" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb11-34"><a href="local_mod.html#cb11-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-35"><a href="local_mod.html#cb11-35" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-36"><a href="local_mod.html#cb11-36" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb11-37"><a href="local_mod.html#cb11-37" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb11-38"><a href="local_mod.html#cb11-38" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Local height to DBH allometry from SfM-extracted DBH samples&quot;</span></span>
<span id="cb11-39"><a href="local_mod.html#cb11-39" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb11-40"><a href="local_mod.html#cb11-40" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(&quot;</span></span>
<span id="cb11-41"><a href="local_mod.html#cb11-41" tabindex="-1"></a>      , mod_quad_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Intercept&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb11-42"><a href="local_mod.html#cb11-42" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb11-43"><a href="local_mod.html#cb11-43" tabindex="-1"></a>      , mod_quad_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_tree_height_m&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb11-44"><a href="local_mod.html#cb11-44" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height&quot;</span></span>
<span id="cb11-45"><a href="local_mod.html#cb11-45" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb11-46"><a href="local_mod.html#cb11-46" tabindex="-1"></a>      , mod_quad_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Itree_height_mE2&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb11-47"><a href="local_mod.html#cb11-47" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height^2)$&quot;</span></span>
<span id="cb11-48"><a href="local_mod.html#cb11-48" tabindex="-1"></a>    ))</span>
<span id="cb11-49"><a href="local_mod.html#cb11-49" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-50"><a href="local_mod.html#cb11-50" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb11-51"><a href="local_mod.html#cb11-51" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/mod-quad-pred-1.png" width="1008" /></p>
</div>
<div id="training-vs-non-training-dbh-2" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Training vs Non-Training DBH<a href="local_mod.html#training-vs-non-training-dbh-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="local_mod.html#cb12-1" tabindex="-1"></a><span class="do">### plot</span></span>
<span id="cb12-2"><a href="local_mod.html#cb12-2" tabindex="-1"></a>plt_quad <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="local_mod.html#cb12-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="local_mod.html#cb12-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="local_mod.html#cb12-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb12-6"><a href="local_mod.html#cb12-6" tabindex="-1"></a>    treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="local_mod.html#cb12-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="local_mod.html#cb12-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="local_mod.html#cb12-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.15</span>)</span>
<span id="cb12-10"><a href="local_mod.html#cb12-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-11"><a href="local_mod.html#cb12-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb12-12"><a href="local_mod.html#cb12-12" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb12-13"><a href="local_mod.html#cb12-13" tabindex="-1"></a>      <span class="at">x=</span>tree_height_m, <span class="at">y =</span> mod_quad_est_dbh_cm</span>
<span id="cb12-14"><a href="local_mod.html#cb12-14" tabindex="-1"></a>      , <span class="at">color =</span> is_training_data</span>
<span id="cb12-15"><a href="local_mod.html#cb12-15" tabindex="-1"></a>      , <span class="at">fill =</span> is_training_data</span>
<span id="cb12-16"><a href="local_mod.html#cb12-16" tabindex="-1"></a>      , <span class="at">group =</span> is_training_data</span>
<span id="cb12-17"><a href="local_mod.html#cb12-17" tabindex="-1"></a>    )</span>
<span id="cb12-18"><a href="local_mod.html#cb12-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-19"><a href="local_mod.html#cb12-19" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb12-20"><a href="local_mod.html#cb12-20" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;loess&quot;</span></span>
<span id="cb12-21"><a href="local_mod.html#cb12-21" tabindex="-1"></a>    , <span class="at">se =</span> F</span>
<span id="cb12-22"><a href="local_mod.html#cb12-22" tabindex="-1"></a>    , <span class="at">span =</span> <span class="dv">1</span></span>
<span id="cb12-23"><a href="local_mod.html#cb12-23" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb12-24"><a href="local_mod.html#cb12-24" tabindex="-1"></a>    , <span class="at">show.legend =</span> T</span>
<span id="cb12-25"><a href="local_mod.html#cb12-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-26"><a href="local_mod.html#cb12-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb12-27"><a href="local_mod.html#cb12-27" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb12-28"><a href="local_mod.html#cb12-28" tabindex="-1"></a>    , <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb12-29"><a href="local_mod.html#cb12-29" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb12-30"><a href="local_mod.html#cb12-30" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb12-31"><a href="local_mod.html#cb12-31" tabindex="-1"></a>    , <span class="at">show.legend =</span> F</span>
<span id="cb12-32"><a href="local_mod.html#cb12-32" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb12-33"><a href="local_mod.html#cb12-33" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb12-34"><a href="local_mod.html#cb12-34" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)</span>
<span id="cb12-35"><a href="local_mod.html#cb12-35" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb12-36"><a href="local_mod.html#cb12-36" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(&quot;</span></span>
<span id="cb12-37"><a href="local_mod.html#cb12-37" tabindex="-1"></a>      , mod_quad_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Intercept&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb12-38"><a href="local_mod.html#cb12-38" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb12-39"><a href="local_mod.html#cb12-39" tabindex="-1"></a>      , mod_quad_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_tree_height_m&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb12-40"><a href="local_mod.html#cb12-40" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height&quot;</span></span>
<span id="cb12-41"><a href="local_mod.html#cb12-41" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb12-42"><a href="local_mod.html#cb12-42" tabindex="-1"></a>      , mod_quad_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Itree_height_mE2&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb12-43"><a href="local_mod.html#cb12-43" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height^2)$&quot;</span></span>
<span id="cb12-44"><a href="local_mod.html#cb12-44" tabindex="-1"></a>    ))</span>
<span id="cb12-45"><a href="local_mod.html#cb12-45" tabindex="-1"></a>    , <span class="at">parse =</span> T</span>
<span id="cb12-46"><a href="local_mod.html#cb12-46" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb12-47"><a href="local_mod.html#cb12-47" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-48"><a href="local_mod.html#cb12-48" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-49"><a href="local_mod.html#cb12-49" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-50"><a href="local_mod.html#cb12-50" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb12-51"><a href="local_mod.html#cb12-51" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>tree_height_m)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb12-52"><a href="local_mod.html#cb12-52" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-53"><a href="local_mod.html#cb12-53" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb12-54"><a href="local_mod.html#cb12-54" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb12-55"><a href="local_mod.html#cb12-55" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Quadratic Model&quot;</span></span>
<span id="cb12-56"><a href="local_mod.html#cb12-56" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;SfM-derived tree height and DBH relationship&quot;</span></span>
<span id="cb12-57"><a href="local_mod.html#cb12-57" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb12-58"><a href="local_mod.html#cb12-58" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb12-59"><a href="local_mod.html#cb12-59" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-60"><a href="local_mod.html#cb12-60" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb12-61"><a href="local_mod.html#cb12-61" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-62"><a href="local_mod.html#cb12-62" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb12-63"><a href="local_mod.html#cb12-63" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb12-64"><a href="local_mod.html#cb12-64" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-65"><a href="local_mod.html#cb12-65" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb12-66"><a href="local_mod.html#cb12-66" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb12-67"><a href="local_mod.html#cb12-67" tabindex="-1"></a>  )</span>
<span id="cb12-68"><a href="local_mod.html#cb12-68" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb12-69"><a href="local_mod.html#cb12-69" tabindex="-1"></a>plt_quad</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/plt-quad-1.png" width="1008" /></p>
</div>
</div>
<div id="no-intercept-quadratic-model" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> No Intercept Quadratic Model<a href="local_mod.html#no-intercept-quadratic-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A quadratic linear model with the inclusion of <span class="math inline">\(Height_{i}^{2}\)</span> in the model allows us to account for a nonlinear (e.g. parabolic) relationship between DBH and tree height. Forcing the intercept to <span class="math inline">\(0\)</span> allows for the model to better account for the minimum tree height threshold set at <code>2 m</code> in the point cloud processing workflow.</p>
<p><span class="math display">\[\begin{align*}
DBH_{i}  &amp;\sim {\sf Gamma} \bigl(g(\beta_1, \beta_2, Height_{i}), shape \bigr) \\
g(\beta_1, \beta_2, Height_{i}) &amp;= {\exp \bigl(0 + \beta_1 \cdot Height_{i} + \beta_2 \cdot Height_{i}^{2}\bigr)} \\
\beta_{1}  &amp;\sim {\sf Normal} (0,10) \\
\beta_{2}  &amp;\sim {\sf Normal} (0,10) \\
shape  &amp;\sim {\sf Gamma} (0.01,0.01)
\end{align*}\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data. The <span class="math inline">\(\sf Gamma\)</span> response distribution represents <span class="math inline">\(DBH_{i}\)</span> as strictly non-negative.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="local_mod.html#cb13-1" tabindex="-1"></a><span class="co"># population model with no random effects (i.e. no group-level variation)</span></span>
<span id="cb13-2"><a href="local_mod.html#cb13-2" tabindex="-1"></a>  <span class="co"># Gamma distribution for strictly positive response variable dbh</span></span>
<span id="cb13-3"><a href="local_mod.html#cb13-3" tabindex="-1"></a>  mod_quad_noint <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb13-4"><a href="local_mod.html#cb13-4" tabindex="-1"></a>    <span class="at">formula =</span> dbh_cm <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> tree_height_m <span class="sc">+</span> <span class="fu">I</span>(tree_height_m<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb13-5"><a href="local_mod.html#cb13-5" tabindex="-1"></a>    , <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb13-6"><a href="local_mod.html#cb13-6" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="local_mod.html#cb13-7" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb13-8"><a href="local_mod.html#cb13-8" tabindex="-1"></a>    , <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">brmsfamily</span>(<span class="st">&quot;Gamma&quot;</span>, <span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb13-9"><a href="local_mod.html#cb13-9" tabindex="-1"></a>    , <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape))</span>
<span id="cb13-10"><a href="local_mod.html#cb13-10" tabindex="-1"></a>    , <span class="at">iter =</span> <span class="dv">3000</span></span>
<span id="cb13-11"><a href="local_mod.html#cb13-11" tabindex="-1"></a>    , <span class="at">file =</span> <span class="st">&quot;../data/mod_quad_noint&quot;</span></span>
<span id="cb13-12"><a href="local_mod.html#cb13-12" tabindex="-1"></a>  )</span>
<span id="cb13-13"><a href="local_mod.html#cb13-13" tabindex="-1"></a>  <span class="co"># plot(mod_quad_noint)</span></span>
<span id="cb13-14"><a href="local_mod.html#cb13-14" tabindex="-1"></a>  <span class="co"># summary(mod_quad_noint)</span></span>
<span id="cb13-15"><a href="local_mod.html#cb13-15" tabindex="-1"></a>  <span class="co"># plot(brms::conditional_effects(mod_quad_noint), points = T)</span></span>
<span id="cb13-16"><a href="local_mod.html#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="local_mod.html#cb13-17" tabindex="-1"></a>  <span class="co"># compute and save the WAIC information for the next three models</span></span>
<span id="cb13-18"><a href="local_mod.html#cb13-18" tabindex="-1"></a>  mod_quad_noint <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(mod_quad_noint, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb13-19"><a href="local_mod.html#cb13-19" tabindex="-1"></a>  </span>
<span id="cb13-20"><a href="local_mod.html#cb13-20" tabindex="-1"></a>  <span class="co"># predict values over range</span></span>
<span id="cb13-21"><a href="local_mod.html#cb13-21" tabindex="-1"></a>  pred_mod_quad_noint <span class="ot">=</span> <span class="fu">predict</span>(</span>
<span id="cb13-22"><a href="local_mod.html#cb13-22" tabindex="-1"></a>      mod_quad_noint</span>
<span id="cb13-23"><a href="local_mod.html#cb13-23" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb13-24"><a href="local_mod.html#cb13-24" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb13-25"><a href="local_mod.html#cb13-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb13-26"><a href="local_mod.html#cb13-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-27"><a href="local_mod.html#cb13-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb13-28"><a href="local_mod.html#cb13-28" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb13-29"><a href="local_mod.html#cb13-29" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-30"><a href="local_mod.html#cb13-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb13-31"><a href="local_mod.html#cb13-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-32"><a href="local_mod.html#cb13-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb13-33"><a href="local_mod.html#cb13-33" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>())</span>
<span id="cb13-34"><a href="local_mod.html#cb13-34" tabindex="-1"></a>  </span>
<span id="cb13-35"><a href="local_mod.html#cb13-35" tabindex="-1"></a>  <span class="co"># attach predicted values to original data</span></span>
<span id="cb13-36"><a href="local_mod.html#cb13-36" tabindex="-1"></a>  treetops_sf_with_dbh <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb13-37"><a href="local_mod.html#cb13-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb13-38"><a href="local_mod.html#cb13-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb13-39"><a href="local_mod.html#cb13-39" tabindex="-1"></a>       pred_mod_quad_noint <span class="sc">%&gt;%</span> </span>
<span id="cb13-40"><a href="local_mod.html#cb13-40" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(tree_height_m_tnth, estimate)</span>
<span id="cb13-41"><a href="local_mod.html#cb13-41" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(tree_height_m_tnth)</span>
<span id="cb13-42"><a href="local_mod.html#cb13-42" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-43"><a href="local_mod.html#cb13-43" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-44"><a href="local_mod.html#cb13-44" tabindex="-1"></a>      <span class="at">mod_quad_noint_est_dbh_cm =</span> <span class="fu">ifelse</span>(is_training_data <span class="sc">==</span> T, dbh_cm, estimate)</span>
<span id="cb13-45"><a href="local_mod.html#cb13-45" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-46"><a href="local_mod.html#cb13-46" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(estimate, tree_height_m_tnth))</span>
<span id="cb13-47"><a href="local_mod.html#cb13-47" tabindex="-1"></a>  </span>
<span id="cb13-48"><a href="local_mod.html#cb13-48" tabindex="-1"></a>  <span class="fu">gc</span>()</span></code></pre></div>
<div id="model-parameter-estimates-2" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Model Parameter Estimates<a href="local_mod.html#model-parameter-estimates-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>No intercept quadratic linear model form:</p>
<p><span class="math display">\[
DBH_{i} = \exp\bigl( 0 + \beta_1 \cdot Height_{i} + \beta_2 \cdot Height_{i}^{2} \bigr)
\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="local_mod.html#cb14-1" tabindex="-1"></a><span class="co"># parameter estimates</span></span>
<span id="cb14-2"><a href="local_mod.html#cb14-2" tabindex="-1"></a>mod_quad_noint_sum_temp <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">posterior_summary</span>(mod_quad_noint) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="local_mod.html#cb14-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="local_mod.html#cb14-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="local_mod.html#cb14-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># | parameter == &quot;shape&quot;) %&gt;% </span></span>
<span id="cb14-6"><a href="local_mod.html#cb14-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) </span>
<span id="cb14-7"><a href="local_mod.html#cb14-7" tabindex="-1"></a>  <span class="co"># dplyr::mutate(</span></span>
<span id="cb14-8"><a href="local_mod.html#cb14-8" tabindex="-1"></a>  <span class="co">#   dplyr::across(.cols = tidyselect::where(is.numeric), .fns = exp)</span></span>
<span id="cb14-9"><a href="local_mod.html#cb14-9" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb14-10"><a href="local_mod.html#cb14-10" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb14-11"><a href="local_mod.html#cb14-11" tabindex="-1"></a>mod_quad_noint_sum_temp <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="local_mod.html#cb14-12" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-13"><a href="local_mod.html#cb14-13" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_tree_height_m
</td>
<td style="text-align:right;">
0.3561
</td>
<td style="text-align:right;">
0.0013
</td>
<td style="text-align:right;">
0.3536
</td>
<td style="text-align:right;">
0.3587
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Itree_height_mE2
</td>
<td style="text-align:right;">
-0.0082
</td>
<td style="text-align:right;">
0.0001
</td>
<td style="text-align:right;">
-0.0084
</td>
<td style="text-align:right;">
-0.0081
</td>
</tr>
</tbody>
</table>
</div>
<div id="sfm-derived-height-to-dbh-allometry-2" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> SfM-derived Height to DBH Allometry<a href="local_mod.html#sfm-derived-height-to-dbh-allometry-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="local_mod.html#cb15-1" tabindex="-1"></a><span class="co"># predict and put estimates in a data frame</span></span>
<span id="cb15-2"><a href="local_mod.html#cb15-2" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb15-3"><a href="local_mod.html#cb15-3" tabindex="-1"></a>      mod_quad_noint</span>
<span id="cb15-4"><a href="local_mod.html#cb15-4" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb15-5"><a href="local_mod.html#cb15-5" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb15-6"><a href="local_mod.html#cb15-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="local_mod.html#cb15-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="local_mod.html#cb15-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb15-9"><a href="local_mod.html#cb15-9" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb15-10"><a href="local_mod.html#cb15-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="local_mod.html#cb15-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="local_mod.html#cb15-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="local_mod.html#cb15-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="local_mod.html#cb15-14" tabindex="-1"></a><span class="co"># plot predictions with data</span></span>
<span id="cb15-15"><a href="local_mod.html#cb15-15" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb15-16"><a href="local_mod.html#cb15-16" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tree_height_m)</span>
<span id="cb15-17"><a href="local_mod.html#cb15-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-18"><a href="local_mod.html#cb15-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb15-19"><a href="local_mod.html#cb15-19" tabindex="-1"></a>    <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb15-20"><a href="local_mod.html#cb15-20" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-21"><a href="local_mod.html#cb15-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb15-22"><a href="local_mod.html#cb15-22" tabindex="-1"></a>    , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> dbh_cm)</span>
<span id="cb15-23"><a href="local_mod.html#cb15-23" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span></span>
<span id="cb15-24"><a href="local_mod.html#cb15-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-25"><a href="local_mod.html#cb15-25" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb15-26"><a href="local_mod.html#cb15-26" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">ymin =</span> lower_b, <span class="at">ymax =</span> upper_b)</span>
<span id="cb15-27"><a href="local_mod.html#cb15-27" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;gray88&quot;</span></span>
<span id="cb15-28"><a href="local_mod.html#cb15-28" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb15-29"><a href="local_mod.html#cb15-29" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-30"><a href="local_mod.html#cb15-30" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb15-31"><a href="local_mod.html#cb15-31" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> estimate)</span>
<span id="cb15-32"><a href="local_mod.html#cb15-32" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span></span>
<span id="cb15-33"><a href="local_mod.html#cb15-33" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb15-34"><a href="local_mod.html#cb15-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-35"><a href="local_mod.html#cb15-35" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-36"><a href="local_mod.html#cb15-36" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb15-37"><a href="local_mod.html#cb15-37" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb15-38"><a href="local_mod.html#cb15-38" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Local height to DBH allometry from SfM-extracted DBH samples&quot;</span></span>
<span id="cb15-39"><a href="local_mod.html#cb15-39" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb15-40"><a href="local_mod.html#cb15-40" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(0&quot;</span></span>
<span id="cb15-41"><a href="local_mod.html#cb15-41" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb15-42"><a href="local_mod.html#cb15-42" tabindex="-1"></a>      , mod_quad_noint_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_tree_height_m&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-43"><a href="local_mod.html#cb15-43" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height&quot;</span></span>
<span id="cb15-44"><a href="local_mod.html#cb15-44" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb15-45"><a href="local_mod.html#cb15-45" tabindex="-1"></a>      , mod_quad_noint_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Itree_height_mE2&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-46"><a href="local_mod.html#cb15-46" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height^2)$&quot;</span></span>
<span id="cb15-47"><a href="local_mod.html#cb15-47" tabindex="-1"></a>    ))</span>
<span id="cb15-48"><a href="local_mod.html#cb15-48" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-49"><a href="local_mod.html#cb15-49" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb15-50"><a href="local_mod.html#cb15-50" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/mod-quad-noint-pred-1.png" width="1008" /></p>
</div>
<div id="training-vs-non-training-dbh-3" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Training vs Non-Training DBH<a href="local_mod.html#training-vs-non-training-dbh-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="local_mod.html#cb16-1" tabindex="-1"></a><span class="do">### plot</span></span>
<span id="cb16-2"><a href="local_mod.html#cb16-2" tabindex="-1"></a>plt_quad_noint <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="local_mod.html#cb16-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="local_mod.html#cb16-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="local_mod.html#cb16-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb16-6"><a href="local_mod.html#cb16-6" tabindex="-1"></a>    treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="local_mod.html#cb16-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="local_mod.html#cb16-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb16-9"><a href="local_mod.html#cb16-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.15</span>)</span>
<span id="cb16-10"><a href="local_mod.html#cb16-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="local_mod.html#cb16-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb16-12"><a href="local_mod.html#cb16-12" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb16-13"><a href="local_mod.html#cb16-13" tabindex="-1"></a>      <span class="at">x=</span>tree_height_m, <span class="at">y =</span> mod_quad_noint_est_dbh_cm</span>
<span id="cb16-14"><a href="local_mod.html#cb16-14" tabindex="-1"></a>      , <span class="at">color =</span> is_training_data</span>
<span id="cb16-15"><a href="local_mod.html#cb16-15" tabindex="-1"></a>      , <span class="at">fill =</span> is_training_data</span>
<span id="cb16-16"><a href="local_mod.html#cb16-16" tabindex="-1"></a>      , <span class="at">group =</span> is_training_data</span>
<span id="cb16-17"><a href="local_mod.html#cb16-17" tabindex="-1"></a>    )</span>
<span id="cb16-18"><a href="local_mod.html#cb16-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-19"><a href="local_mod.html#cb16-19" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb16-20"><a href="local_mod.html#cb16-20" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;loess&quot;</span></span>
<span id="cb16-21"><a href="local_mod.html#cb16-21" tabindex="-1"></a>    , <span class="at">se =</span> F</span>
<span id="cb16-22"><a href="local_mod.html#cb16-22" tabindex="-1"></a>    , <span class="at">span =</span> <span class="dv">1</span></span>
<span id="cb16-23"><a href="local_mod.html#cb16-23" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb16-24"><a href="local_mod.html#cb16-24" tabindex="-1"></a>    , <span class="at">show.legend =</span> T</span>
<span id="cb16-25"><a href="local_mod.html#cb16-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-26"><a href="local_mod.html#cb16-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb16-27"><a href="local_mod.html#cb16-27" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb16-28"><a href="local_mod.html#cb16-28" tabindex="-1"></a>    , <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb16-29"><a href="local_mod.html#cb16-29" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb16-30"><a href="local_mod.html#cb16-30" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb16-31"><a href="local_mod.html#cb16-31" tabindex="-1"></a>    , <span class="at">show.legend =</span> F</span>
<span id="cb16-32"><a href="local_mod.html#cb16-32" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb16-33"><a href="local_mod.html#cb16-33" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb16-34"><a href="local_mod.html#cb16-34" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)</span>
<span id="cb16-35"><a href="local_mod.html#cb16-35" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb16-36"><a href="local_mod.html#cb16-36" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(0&quot;</span></span>
<span id="cb16-37"><a href="local_mod.html#cb16-37" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb16-38"><a href="local_mod.html#cb16-38" tabindex="-1"></a>      , mod_quad_noint_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_tree_height_m&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb16-39"><a href="local_mod.html#cb16-39" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height&quot;</span></span>
<span id="cb16-40"><a href="local_mod.html#cb16-40" tabindex="-1"></a>      , <span class="st">&quot; + &quot;</span></span>
<span id="cb16-41"><a href="local_mod.html#cb16-41" tabindex="-1"></a>      , mod_quad_noint_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_Itree_height_mE2&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb16-42"><a href="local_mod.html#cb16-42" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height^2)$&quot;</span></span>
<span id="cb16-43"><a href="local_mod.html#cb16-43" tabindex="-1"></a>    ))</span>
<span id="cb16-44"><a href="local_mod.html#cb16-44" tabindex="-1"></a>    , <span class="at">parse =</span> T</span>
<span id="cb16-45"><a href="local_mod.html#cb16-45" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb16-46"><a href="local_mod.html#cb16-46" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-47"><a href="local_mod.html#cb16-47" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb16-48"><a href="local_mod.html#cb16-48" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb16-49"><a href="local_mod.html#cb16-49" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb16-50"><a href="local_mod.html#cb16-50" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>tree_height_m)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb16-51"><a href="local_mod.html#cb16-51" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-52"><a href="local_mod.html#cb16-52" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb16-53"><a href="local_mod.html#cb16-53" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb16-54"><a href="local_mod.html#cb16-54" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;No Intercept Quadratic Model&quot;</span></span>
<span id="cb16-55"><a href="local_mod.html#cb16-55" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;SfM-derived tree height and DBH relationship&quot;</span></span>
<span id="cb16-56"><a href="local_mod.html#cb16-56" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb16-57"><a href="local_mod.html#cb16-57" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb16-58"><a href="local_mod.html#cb16-58" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-59"><a href="local_mod.html#cb16-59" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb16-60"><a href="local_mod.html#cb16-60" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb16-61"><a href="local_mod.html#cb16-61" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb16-62"><a href="local_mod.html#cb16-62" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb16-63"><a href="local_mod.html#cb16-63" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-64"><a href="local_mod.html#cb16-64" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb16-65"><a href="local_mod.html#cb16-65" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb16-66"><a href="local_mod.html#cb16-66" tabindex="-1"></a>  )</span>
<span id="cb16-67"><a href="local_mod.html#cb16-67" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb16-68"><a href="local_mod.html#cb16-68" tabindex="-1"></a>plt_quad_noint</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/plt-quad-noint-1.png" width="1008" /></p>
</div>
</div>
<div id="nonlinear-power-model" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Nonlinear Power Model<a href="local_mod.html#nonlinear-power-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A power-law function model allows us to account for a nonlinear relationship between DBH and tree height:</p>
<p><span class="math display">\[\begin{align*}
DBH_{i}  &amp;\sim {\sf Gamma} \bigl(g(\alpha, \kappa, Height_{i}), shape \bigr) \\
g(\alpha, \kappa, Height_{i}) &amp;= {\exp \bigl(\alpha \cdot Height_{i}^{\kappa}\bigr)} \\
\alpha  &amp;\sim {\sf Normal} (0,10) \\
\kappa  &amp;\sim {\sf Normal} (0,10) \\
shape  &amp;\sim {\sf Gamma} (0.01,0.01)
\end{align*}\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data. The <span class="math inline">\(\sf Gamma\)</span> response distribution represents <span class="math inline">\(DBH_{i}\)</span> as strictly non-negative.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="local_mod.html#cb17-1" tabindex="-1"></a><span class="co"># population model with no random effects (i.e. no group-level variation)</span></span>
<span id="cb17-2"><a href="local_mod.html#cb17-2" tabindex="-1"></a>  <span class="co"># Gamma distribution for strictly positive response variable dbh</span></span>
<span id="cb17-3"><a href="local_mod.html#cb17-3" tabindex="-1"></a>  mod_pwr <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb17-4"><a href="local_mod.html#cb17-4" tabindex="-1"></a>    <span class="at">formula =</span> brms<span class="sc">::</span><span class="fu">bf</span>(</span>
<span id="cb17-5"><a href="local_mod.html#cb17-5" tabindex="-1"></a>      <span class="at">formula =</span> dbh_cm <span class="sc">~</span> a <span class="sc">*</span> (tree_height_m<span class="sc">^</span>k)</span>
<span id="cb17-6"><a href="local_mod.html#cb17-6" tabindex="-1"></a>      , a <span class="sc">+</span> k <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb17-7"><a href="local_mod.html#cb17-7" tabindex="-1"></a>      , <span class="at">nl =</span> <span class="cn">TRUE</span> <span class="co"># !! specify non-linear</span></span>
<span id="cb17-8"><a href="local_mod.html#cb17-8" tabindex="-1"></a>    )</span>
<span id="cb17-9"><a href="local_mod.html#cb17-9" tabindex="-1"></a>    , <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="local_mod.html#cb17-10" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href="local_mod.html#cb17-11" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb17-12"><a href="local_mod.html#cb17-12" tabindex="-1"></a>    , <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">brmsfamily</span>(<span class="st">&quot;Gamma&quot;</span>, <span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb17-13"><a href="local_mod.html#cb17-13" tabindex="-1"></a>    , <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape))</span>
<span id="cb17-14"><a href="local_mod.html#cb17-14" tabindex="-1"></a>    , <span class="at">iter =</span> <span class="dv">3000</span></span>
<span id="cb17-15"><a href="local_mod.html#cb17-15" tabindex="-1"></a>    , <span class="at">file =</span> <span class="st">&quot;../data/mod_pwr&quot;</span></span>
<span id="cb17-16"><a href="local_mod.html#cb17-16" tabindex="-1"></a>  )</span>
<span id="cb17-17"><a href="local_mod.html#cb17-17" tabindex="-1"></a>  <span class="co"># plot(mod_pwr)</span></span>
<span id="cb17-18"><a href="local_mod.html#cb17-18" tabindex="-1"></a>  <span class="co"># summary(mod_pwr)</span></span>
<span id="cb17-19"><a href="local_mod.html#cb17-19" tabindex="-1"></a>  <span class="co"># plot(brms::conditional_effects(mod_pwr), points = T)</span></span>
<span id="cb17-20"><a href="local_mod.html#cb17-20" tabindex="-1"></a></span>
<span id="cb17-21"><a href="local_mod.html#cb17-21" tabindex="-1"></a>  <span class="co"># compute and save the WAIC information for the next three models</span></span>
<span id="cb17-22"><a href="local_mod.html#cb17-22" tabindex="-1"></a>  mod_pwr <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(mod_pwr, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb17-23"><a href="local_mod.html#cb17-23" tabindex="-1"></a>  </span>
<span id="cb17-24"><a href="local_mod.html#cb17-24" tabindex="-1"></a>  <span class="co"># predict values over range</span></span>
<span id="cb17-25"><a href="local_mod.html#cb17-25" tabindex="-1"></a>  pred_mod_pwr <span class="ot">=</span> <span class="fu">predict</span>(</span>
<span id="cb17-26"><a href="local_mod.html#cb17-26" tabindex="-1"></a>      mod_pwr</span>
<span id="cb17-27"><a href="local_mod.html#cb17-27" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb17-28"><a href="local_mod.html#cb17-28" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb17-29"><a href="local_mod.html#cb17-29" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb17-30"><a href="local_mod.html#cb17-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-31"><a href="local_mod.html#cb17-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb17-32"><a href="local_mod.html#cb17-32" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb17-33"><a href="local_mod.html#cb17-33" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-34"><a href="local_mod.html#cb17-34" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb17-35"><a href="local_mod.html#cb17-35" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-36"><a href="local_mod.html#cb17-36" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb17-37"><a href="local_mod.html#cb17-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>())</span>
<span id="cb17-38"><a href="local_mod.html#cb17-38" tabindex="-1"></a>  </span>
<span id="cb17-39"><a href="local_mod.html#cb17-39" tabindex="-1"></a>  <span class="co"># attach predicted values to original data</span></span>
<span id="cb17-40"><a href="local_mod.html#cb17-40" tabindex="-1"></a>  treetops_sf_with_dbh <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb17-41"><a href="local_mod.html#cb17-41" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-42"><a href="local_mod.html#cb17-42" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb17-43"><a href="local_mod.html#cb17-43" tabindex="-1"></a>       pred_mod_pwr <span class="sc">%&gt;%</span> </span>
<span id="cb17-44"><a href="local_mod.html#cb17-44" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(tree_height_m_tnth, estimate)</span>
<span id="cb17-45"><a href="local_mod.html#cb17-45" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(tree_height_m_tnth)</span>
<span id="cb17-46"><a href="local_mod.html#cb17-46" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-47"><a href="local_mod.html#cb17-47" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-48"><a href="local_mod.html#cb17-48" tabindex="-1"></a>      <span class="at">mod_pwr_est_dbh_cm =</span> <span class="fu">ifelse</span>(is_training_data <span class="sc">==</span> T, dbh_cm, estimate)</span>
<span id="cb17-49"><a href="local_mod.html#cb17-49" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-50"><a href="local_mod.html#cb17-50" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(estimate, tree_height_m_tnth))</span>
<span id="cb17-51"><a href="local_mod.html#cb17-51" tabindex="-1"></a>  </span>
<span id="cb17-52"><a href="local_mod.html#cb17-52" tabindex="-1"></a>  <span class="fu">gc</span>()</span></code></pre></div>
<div id="model-parameter-estimates-3" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Model Parameter Estimates<a href="local_mod.html#model-parameter-estimates-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Power-law function model form:</p>
<p><span class="math display">\[
DBH_{i} = \exp\bigl(\alpha \cdot Height_{i}^{\kappa}\bigr)
\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="local_mod.html#cb18-1" tabindex="-1"></a><span class="co"># parameter estimates</span></span>
<span id="cb18-2"><a href="local_mod.html#cb18-2" tabindex="-1"></a>mod_pwr_sum_temp <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">posterior_summary</span>(mod_pwr) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="local_mod.html#cb18-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="local_mod.html#cb18-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="local_mod.html#cb18-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># | parameter == &quot;shape&quot;) %&gt;% </span></span>
<span id="cb18-6"><a href="local_mod.html#cb18-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="local_mod.html#cb18-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb18-8"><a href="local_mod.html#cb18-8" tabindex="-1"></a>    <span class="at">parameter =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="fu">tolower</span>(parameter), <span class="st">&quot;_intercept&quot;</span>)</span>
<span id="cb18-9"><a href="local_mod.html#cb18-9" tabindex="-1"></a>    <span class="co"># , dplyr::across(.cols = tidyselect::where(is.numeric), .fns = exp)</span></span>
<span id="cb18-10"><a href="local_mod.html#cb18-10" tabindex="-1"></a>  )</span>
<span id="cb18-11"><a href="local_mod.html#cb18-11" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb18-12"><a href="local_mod.html#cb18-12" tabindex="-1"></a>mod_pwr_sum_temp <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="local_mod.html#cb18-13" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-14"><a href="local_mod.html#cb18-14" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a
</td>
<td style="text-align:right;">
1.4022
</td>
<td style="text-align:right;">
0.0205
</td>
<td style="text-align:right;">
1.3610
</td>
<td style="text-align:right;">
1.4424
</td>
</tr>
<tr>
<td style="text-align:left;">
b_k
</td>
<td style="text-align:right;">
0.3310
</td>
<td style="text-align:right;">
0.0052
</td>
<td style="text-align:right;">
0.3208
</td>
<td style="text-align:right;">
0.3416
</td>
</tr>
</tbody>
</table>
</div>
<div id="sfm-derived-height-to-dbh-allometry-3" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> SfM-derived Height to DBH Allometry<a href="local_mod.html#sfm-derived-height-to-dbh-allometry-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="local_mod.html#cb19-1" tabindex="-1"></a><span class="co"># predict and put estimates in a data frame</span></span>
<span id="cb19-2"><a href="local_mod.html#cb19-2" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb19-3"><a href="local_mod.html#cb19-3" tabindex="-1"></a>      mod_pwr</span>
<span id="cb19-4"><a href="local_mod.html#cb19-4" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb19-5"><a href="local_mod.html#cb19-5" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb19-6"><a href="local_mod.html#cb19-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="local_mod.html#cb19-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="local_mod.html#cb19-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb19-9"><a href="local_mod.html#cb19-9" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb19-10"><a href="local_mod.html#cb19-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-11"><a href="local_mod.html#cb19-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb19-12"><a href="local_mod.html#cb19-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-13"><a href="local_mod.html#cb19-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb19-14"><a href="local_mod.html#cb19-14" tabindex="-1"></a><span class="co"># plot predictions with data</span></span>
<span id="cb19-15"><a href="local_mod.html#cb19-15" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb19-16"><a href="local_mod.html#cb19-16" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tree_height_m)</span>
<span id="cb19-17"><a href="local_mod.html#cb19-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-18"><a href="local_mod.html#cb19-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb19-19"><a href="local_mod.html#cb19-19" tabindex="-1"></a>    <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb19-20"><a href="local_mod.html#cb19-20" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb19-21"><a href="local_mod.html#cb19-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb19-22"><a href="local_mod.html#cb19-22" tabindex="-1"></a>    , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> dbh_cm)</span>
<span id="cb19-23"><a href="local_mod.html#cb19-23" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span></span>
<span id="cb19-24"><a href="local_mod.html#cb19-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-25"><a href="local_mod.html#cb19-25" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb19-26"><a href="local_mod.html#cb19-26" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">ymin =</span> lower_b, <span class="at">ymax =</span> upper_b)</span>
<span id="cb19-27"><a href="local_mod.html#cb19-27" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;gray88&quot;</span></span>
<span id="cb19-28"><a href="local_mod.html#cb19-28" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb19-29"><a href="local_mod.html#cb19-29" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-30"><a href="local_mod.html#cb19-30" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb19-31"><a href="local_mod.html#cb19-31" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> estimate)</span>
<span id="cb19-32"><a href="local_mod.html#cb19-32" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span></span>
<span id="cb19-33"><a href="local_mod.html#cb19-33" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb19-34"><a href="local_mod.html#cb19-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-35"><a href="local_mod.html#cb19-35" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-36"><a href="local_mod.html#cb19-36" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb19-37"><a href="local_mod.html#cb19-37" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb19-38"><a href="local_mod.html#cb19-38" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Local height to DBH allometry from SfM-extracted DBH samples&quot;</span></span>
<span id="cb19-39"><a href="local_mod.html#cb19-39" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb19-40"><a href="local_mod.html#cb19-40" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(&quot;</span></span>
<span id="cb19-41"><a href="local_mod.html#cb19-41" tabindex="-1"></a>      , mod_pwr_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_a&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb19-42"><a href="local_mod.html#cb19-42" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height^{&quot;</span></span>
<span id="cb19-43"><a href="local_mod.html#cb19-43" tabindex="-1"></a>      , mod_pwr_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_k&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb19-44"><a href="local_mod.html#cb19-44" tabindex="-1"></a>      , <span class="st">&quot;})$&quot;</span></span>
<span id="cb19-45"><a href="local_mod.html#cb19-45" tabindex="-1"></a>    ))</span>
<span id="cb19-46"><a href="local_mod.html#cb19-46" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-47"><a href="local_mod.html#cb19-47" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb19-48"><a href="local_mod.html#cb19-48" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/mod-pwr-pred-1.png" width="1008" /></p>
</div>
<div id="training-vs-non-training-dbh-4" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Training vs Non-Training DBH<a href="local_mod.html#training-vs-non-training-dbh-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="local_mod.html#cb20-1" tabindex="-1"></a><span class="do">### plot</span></span>
<span id="cb20-2"><a href="local_mod.html#cb20-2" tabindex="-1"></a>plt_pwr <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="local_mod.html#cb20-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="local_mod.html#cb20-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="local_mod.html#cb20-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb20-6"><a href="local_mod.html#cb20-6" tabindex="-1"></a>    treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="local_mod.html#cb20-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="local_mod.html#cb20-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="local_mod.html#cb20-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.15</span>)</span>
<span id="cb20-10"><a href="local_mod.html#cb20-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-11"><a href="local_mod.html#cb20-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb20-12"><a href="local_mod.html#cb20-12" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb20-13"><a href="local_mod.html#cb20-13" tabindex="-1"></a>      <span class="at">x=</span>tree_height_m, <span class="at">y =</span> mod_pwr_est_dbh_cm</span>
<span id="cb20-14"><a href="local_mod.html#cb20-14" tabindex="-1"></a>      , <span class="at">color =</span> is_training_data</span>
<span id="cb20-15"><a href="local_mod.html#cb20-15" tabindex="-1"></a>      , <span class="at">fill =</span> is_training_data</span>
<span id="cb20-16"><a href="local_mod.html#cb20-16" tabindex="-1"></a>      , <span class="at">group =</span> is_training_data</span>
<span id="cb20-17"><a href="local_mod.html#cb20-17" tabindex="-1"></a>    )</span>
<span id="cb20-18"><a href="local_mod.html#cb20-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-19"><a href="local_mod.html#cb20-19" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb20-20"><a href="local_mod.html#cb20-20" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;loess&quot;</span></span>
<span id="cb20-21"><a href="local_mod.html#cb20-21" tabindex="-1"></a>    , <span class="at">se =</span> F</span>
<span id="cb20-22"><a href="local_mod.html#cb20-22" tabindex="-1"></a>    , <span class="at">span =</span> <span class="dv">1</span></span>
<span id="cb20-23"><a href="local_mod.html#cb20-23" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb20-24"><a href="local_mod.html#cb20-24" tabindex="-1"></a>    , <span class="at">show.legend =</span> T</span>
<span id="cb20-25"><a href="local_mod.html#cb20-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-26"><a href="local_mod.html#cb20-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb20-27"><a href="local_mod.html#cb20-27" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb20-28"><a href="local_mod.html#cb20-28" tabindex="-1"></a>    , <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb20-29"><a href="local_mod.html#cb20-29" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb20-30"><a href="local_mod.html#cb20-30" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb20-31"><a href="local_mod.html#cb20-31" tabindex="-1"></a>    , <span class="at">show.legend =</span> F</span>
<span id="cb20-32"><a href="local_mod.html#cb20-32" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb20-33"><a href="local_mod.html#cb20-33" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb20-34"><a href="local_mod.html#cb20-34" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)</span>
<span id="cb20-35"><a href="local_mod.html#cb20-35" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb20-36"><a href="local_mod.html#cb20-36" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(&quot;</span></span>
<span id="cb20-37"><a href="local_mod.html#cb20-37" tabindex="-1"></a>      , mod_pwr_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_a&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb20-38"><a href="local_mod.html#cb20-38" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot Height^{&quot;</span></span>
<span id="cb20-39"><a href="local_mod.html#cb20-39" tabindex="-1"></a>      , mod_pwr_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_k&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb20-40"><a href="local_mod.html#cb20-40" tabindex="-1"></a>      , <span class="st">&quot;})$&quot;</span></span>
<span id="cb20-41"><a href="local_mod.html#cb20-41" tabindex="-1"></a>    ))</span>
<span id="cb20-42"><a href="local_mod.html#cb20-42" tabindex="-1"></a>    , <span class="at">parse =</span> T</span>
<span id="cb20-43"><a href="local_mod.html#cb20-43" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb20-44"><a href="local_mod.html#cb20-44" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-45"><a href="local_mod.html#cb20-45" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb20-46"><a href="local_mod.html#cb20-46" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb20-47"><a href="local_mod.html#cb20-47" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb20-48"><a href="local_mod.html#cb20-48" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>tree_height_m)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb20-49"><a href="local_mod.html#cb20-49" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-50"><a href="local_mod.html#cb20-50" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb20-51"><a href="local_mod.html#cb20-51" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb20-52"><a href="local_mod.html#cb20-52" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Nonlinear Power Model&quot;</span></span>
<span id="cb20-53"><a href="local_mod.html#cb20-53" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;SfM-derived tree height and DBH relationship&quot;</span></span>
<span id="cb20-54"><a href="local_mod.html#cb20-54" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb20-55"><a href="local_mod.html#cb20-55" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb20-56"><a href="local_mod.html#cb20-56" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-57"><a href="local_mod.html#cb20-57" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb20-58"><a href="local_mod.html#cb20-58" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-59"><a href="local_mod.html#cb20-59" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb20-60"><a href="local_mod.html#cb20-60" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb20-61"><a href="local_mod.html#cb20-61" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-62"><a href="local_mod.html#cb20-62" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb20-63"><a href="local_mod.html#cb20-63" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb20-64"><a href="local_mod.html#cb20-64" tabindex="-1"></a>  )</span>
<span id="cb20-65"><a href="local_mod.html#cb20-65" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb20-66"><a href="local_mod.html#cb20-66" tabindex="-1"></a>plt_pwr</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/plt-pwr-1.png" width="1008" /></p>
</div>
</div>
<div id="nonlinear-weibull-model" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Nonlinear Weibull Model<a href="local_mod.html#nonlinear-weibull-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://scholar.google.com/scholar?cluster=17788684010143614597&amp;hl=en&amp;as_sdt=0,6">Pilli et al. (2006)</a> suggest a Weibull function for estimating DBH to height allometric relationships to allow for a nonlinear relationship:</p>
<p><span class="math display">\[\begin{align*}
DBH_{i}  &amp;\sim {\sf Gamma} \bigl(g(a, b, Height_{i}), shape \bigr) \\
g(a, b, Height_{i}) &amp;= {\exp\biggl(a \cdot \bigl(1-\exp(-Height_{i}/b)\bigr)\biggr)} \\
a  &amp;\sim {\sf Normal} (0,10) \\
b  &amp;\sim {\sf Normal} (0,10) \\
shape  &amp;\sim {\sf Gamma} (0.01,0.01)
\end{align*}\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data. The <span class="math inline">\(\sf Gamma\)</span> response distribution represents <span class="math inline">\(DBH_{i}\)</span> as strictly non-negative.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="local_mod.html#cb21-1" tabindex="-1"></a><span class="co"># population model with no random effects (i.e. no group-level variation)</span></span>
<span id="cb21-2"><a href="local_mod.html#cb21-2" tabindex="-1"></a>  <span class="co"># Gamma distribution for strictly positive response variable dbh</span></span>
<span id="cb21-3"><a href="local_mod.html#cb21-3" tabindex="-1"></a>  <span class="co"># a × (1−exp(−DBH/b))</span></span>
<span id="cb21-4"><a href="local_mod.html#cb21-4" tabindex="-1"></a>  mod_weib <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb21-5"><a href="local_mod.html#cb21-5" tabindex="-1"></a>    <span class="at">formula =</span> brms<span class="sc">::</span><span class="fu">bf</span>(</span>
<span id="cb21-6"><a href="local_mod.html#cb21-6" tabindex="-1"></a>      <span class="at">formula =</span> dbh_cm <span class="sc">~</span> a <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>tree_height_m<span class="sc">/</span>b))</span>
<span id="cb21-7"><a href="local_mod.html#cb21-7" tabindex="-1"></a>      , a <span class="sc">+</span> b <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb21-8"><a href="local_mod.html#cb21-8" tabindex="-1"></a>      , <span class="at">nl =</span> <span class="cn">TRUE</span> <span class="co"># !! specify non-linear</span></span>
<span id="cb21-9"><a href="local_mod.html#cb21-9" tabindex="-1"></a>    )</span>
<span id="cb21-10"><a href="local_mod.html#cb21-10" tabindex="-1"></a>    , <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="local_mod.html#cb21-11" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-12"><a href="local_mod.html#cb21-12" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb21-13"><a href="local_mod.html#cb21-13" tabindex="-1"></a>    , <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">brmsfamily</span>(<span class="st">&quot;Gamma&quot;</span>, <span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb21-14"><a href="local_mod.html#cb21-14" tabindex="-1"></a>    , <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape))</span>
<span id="cb21-15"><a href="local_mod.html#cb21-15" tabindex="-1"></a>    , <span class="at">iter =</span> <span class="dv">3000</span></span>
<span id="cb21-16"><a href="local_mod.html#cb21-16" tabindex="-1"></a>    , <span class="at">file =</span> <span class="st">&quot;../data/mod_weib&quot;</span></span>
<span id="cb21-17"><a href="local_mod.html#cb21-17" tabindex="-1"></a>  )</span>
<span id="cb21-18"><a href="local_mod.html#cb21-18" tabindex="-1"></a>  <span class="co"># plot(mod_weib)</span></span>
<span id="cb21-19"><a href="local_mod.html#cb21-19" tabindex="-1"></a>  <span class="co"># summary(mod_weib)</span></span>
<span id="cb21-20"><a href="local_mod.html#cb21-20" tabindex="-1"></a>  <span class="co"># plot(brms::conditional_effects(mod_weib), points = T)</span></span>
<span id="cb21-21"><a href="local_mod.html#cb21-21" tabindex="-1"></a></span>
<span id="cb21-22"><a href="local_mod.html#cb21-22" tabindex="-1"></a>  <span class="co"># compute and save the WAIC information for the next three models</span></span>
<span id="cb21-23"><a href="local_mod.html#cb21-23" tabindex="-1"></a>  mod_weib <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(mod_weib, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb21-24"><a href="local_mod.html#cb21-24" tabindex="-1"></a>  </span>
<span id="cb21-25"><a href="local_mod.html#cb21-25" tabindex="-1"></a>  <span class="co"># predict values over range</span></span>
<span id="cb21-26"><a href="local_mod.html#cb21-26" tabindex="-1"></a>  pred_mod_weib <span class="ot">=</span> <span class="fu">predict</span>(</span>
<span id="cb21-27"><a href="local_mod.html#cb21-27" tabindex="-1"></a>      mod_weib</span>
<span id="cb21-28"><a href="local_mod.html#cb21-28" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb21-29"><a href="local_mod.html#cb21-29" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb21-30"><a href="local_mod.html#cb21-30" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-31"><a href="local_mod.html#cb21-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-32"><a href="local_mod.html#cb21-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb21-33"><a href="local_mod.html#cb21-33" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb21-34"><a href="local_mod.html#cb21-34" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-35"><a href="local_mod.html#cb21-35" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb21-36"><a href="local_mod.html#cb21-36" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-37"><a href="local_mod.html#cb21-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb21-38"><a href="local_mod.html#cb21-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>())</span>
<span id="cb21-39"><a href="local_mod.html#cb21-39" tabindex="-1"></a>  </span>
<span id="cb21-40"><a href="local_mod.html#cb21-40" tabindex="-1"></a>  <span class="co"># attach predicted values to original data</span></span>
<span id="cb21-41"><a href="local_mod.html#cb21-41" tabindex="-1"></a>  treetops_sf_with_dbh <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb21-42"><a href="local_mod.html#cb21-42" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_height_m_tnth =</span> <span class="fu">round</span>(tree_height_m,<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb21-43"><a href="local_mod.html#cb21-43" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb21-44"><a href="local_mod.html#cb21-44" tabindex="-1"></a>       pred_mod_weib <span class="sc">%&gt;%</span> </span>
<span id="cb21-45"><a href="local_mod.html#cb21-45" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(tree_height_m_tnth, estimate)</span>
<span id="cb21-46"><a href="local_mod.html#cb21-46" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(tree_height_m_tnth)</span>
<span id="cb21-47"><a href="local_mod.html#cb21-47" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-48"><a href="local_mod.html#cb21-48" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb21-49"><a href="local_mod.html#cb21-49" tabindex="-1"></a>      <span class="at">mod_weib_est_dbh_cm =</span> <span class="fu">ifelse</span>(is_training_data <span class="sc">==</span> T, dbh_cm, estimate)</span>
<span id="cb21-50"><a href="local_mod.html#cb21-50" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-51"><a href="local_mod.html#cb21-51" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(estimate, tree_height_m_tnth))</span>
<span id="cb21-52"><a href="local_mod.html#cb21-52" tabindex="-1"></a>  </span>
<span id="cb21-53"><a href="local_mod.html#cb21-53" tabindex="-1"></a>  <span class="fu">gc</span>()</span></code></pre></div>
<div id="model-parameter-estimates-4" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Model Parameter Estimates<a href="local_mod.html#model-parameter-estimates-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Weibull function model form:</p>
<p><span class="math display">\[
DBH_{i} = \exp\biggl(a \cdot \bigl(1-\exp(-Height_{i}/b)\bigr)\biggr)
\]</span></p>
<p>, where <span class="math inline">\(i\)</span> is the individual tree estimate from UAS SfM data</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="local_mod.html#cb22-1" tabindex="-1"></a><span class="co"># parameter estimates</span></span>
<span id="cb22-2"><a href="local_mod.html#cb22-2" tabindex="-1"></a>mod_weib_sum_temp <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">posterior_summary</span>(mod_weib) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="local_mod.html#cb22-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="local_mod.html#cb22-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="local_mod.html#cb22-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># | parameter == &quot;shape&quot;) %&gt;% </span></span>
<span id="cb22-6"><a href="local_mod.html#cb22-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="local_mod.html#cb22-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb22-8"><a href="local_mod.html#cb22-8" tabindex="-1"></a>    <span class="at">parameter =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="fu">tolower</span>(parameter), <span class="st">&quot;_intercept&quot;</span>)</span>
<span id="cb22-9"><a href="local_mod.html#cb22-9" tabindex="-1"></a>    <span class="co"># , dplyr::across(.cols = tidyselect::where(is.numeric), .fns = exp)</span></span>
<span id="cb22-10"><a href="local_mod.html#cb22-10" tabindex="-1"></a>  )</span>
<span id="cb22-11"><a href="local_mod.html#cb22-11" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb22-12"><a href="local_mod.html#cb22-12" tabindex="-1"></a>mod_weib_sum_temp <span class="sc">%&gt;%</span> </span>
<span id="cb22-13"><a href="local_mod.html#cb22-13" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-14"><a href="local_mod.html#cb22-14" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a
</td>
<td style="text-align:right;">
4.0870
</td>
<td style="text-align:right;">
0.0172
</td>
<td style="text-align:right;">
4.0549
</td>
<td style="text-align:right;">
4.1214
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b
</td>
<td style="text-align:right;">
7.9347
</td>
<td style="text-align:right;">
0.1050
</td>
<td style="text-align:right;">
7.7372
</td>
<td style="text-align:right;">
8.1441
</td>
</tr>
</tbody>
</table>
</div>
<div id="sfm-derived-height-to-dbh-allometry-4" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> SfM-derived Height to DBH Allometry<a href="local_mod.html#sfm-derived-height-to-dbh-allometry-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="local_mod.html#cb23-1" tabindex="-1"></a><span class="co"># predict and put estimates in a data frame</span></span>
<span id="cb23-2"><a href="local_mod.html#cb23-2" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb23-3"><a href="local_mod.html#cb23-3" tabindex="-1"></a>      mod_weib</span>
<span id="cb23-4"><a href="local_mod.html#cb23-4" tabindex="-1"></a>      , <span class="at">newdata =</span> height_range</span>
<span id="cb23-5"><a href="local_mod.html#cb23-5" tabindex="-1"></a>      , <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)</span>
<span id="cb23-6"><a href="local_mod.html#cb23-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="local_mod.html#cb23-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="local_mod.html#cb23-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb23-9"><a href="local_mod.html#cb23-9" tabindex="-1"></a>      <span class="at">lower_b =</span> <span class="dv">3</span>, <span class="at">upper_b =</span> <span class="dv">4</span></span>
<span id="cb23-10"><a href="local_mod.html#cb23-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="local_mod.html#cb23-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="local_mod.html#cb23-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(est.error)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-13"><a href="local_mod.html#cb23-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(height_range) <span class="sc">%&gt;%</span> </span>
<span id="cb23-14"><a href="local_mod.html#cb23-14" tabindex="-1"></a><span class="co"># plot predictions with data</span></span>
<span id="cb23-15"><a href="local_mod.html#cb23-15" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb23-16"><a href="local_mod.html#cb23-16" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tree_height_m)</span>
<span id="cb23-17"><a href="local_mod.html#cb23-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-18"><a href="local_mod.html#cb23-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb23-19"><a href="local_mod.html#cb23-19" tabindex="-1"></a>    <span class="at">data =</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb23-20"><a href="local_mod.html#cb23-20" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-21"><a href="local_mod.html#cb23-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T)</span>
<span id="cb23-22"><a href="local_mod.html#cb23-22" tabindex="-1"></a>    , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> dbh_cm)</span>
<span id="cb23-23"><a href="local_mod.html#cb23-23" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span></span>
<span id="cb23-24"><a href="local_mod.html#cb23-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-25"><a href="local_mod.html#cb23-25" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb23-26"><a href="local_mod.html#cb23-26" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">ymin =</span> lower_b, <span class="at">ymax =</span> upper_b)</span>
<span id="cb23-27"><a href="local_mod.html#cb23-27" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;gray88&quot;</span></span>
<span id="cb23-28"><a href="local_mod.html#cb23-28" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb23-29"><a href="local_mod.html#cb23-29" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-30"><a href="local_mod.html#cb23-30" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb23-31"><a href="local_mod.html#cb23-31" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> estimate)</span>
<span id="cb23-32"><a href="local_mod.html#cb23-32" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span></span>
<span id="cb23-33"><a href="local_mod.html#cb23-33" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb23-34"><a href="local_mod.html#cb23-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-35"><a href="local_mod.html#cb23-35" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-36"><a href="local_mod.html#cb23-36" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb23-37"><a href="local_mod.html#cb23-37" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb23-38"><a href="local_mod.html#cb23-38" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Local height to DBH allometry from SfM-extracted DBH samples&quot;</span></span>
<span id="cb23-39"><a href="local_mod.html#cb23-39" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb23-40"><a href="local_mod.html#cb23-40" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(&quot;</span></span>
<span id="cb23-41"><a href="local_mod.html#cb23-41" tabindex="-1"></a>      , mod_weib_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_a&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb23-42"><a href="local_mod.html#cb23-42" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot (1-</span><span class="sc">\\</span><span class="st">exp(-Height/&quot;</span></span>
<span id="cb23-43"><a href="local_mod.html#cb23-43" tabindex="-1"></a>      , mod_weib_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_b&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb23-44"><a href="local_mod.html#cb23-44" tabindex="-1"></a>      , <span class="st">&quot;)))$&quot;</span></span>
<span id="cb23-45"><a href="local_mod.html#cb23-45" tabindex="-1"></a>    ))</span>
<span id="cb23-46"><a href="local_mod.html#cb23-46" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-47"><a href="local_mod.html#cb23-47" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb23-48"><a href="local_mod.html#cb23-48" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/mod-weib-pred-1.png" width="1008" /></p>
</div>
<div id="training-vs-non-training-dbh-5" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Training vs Non-Training DBH<a href="local_mod.html#training-vs-non-training-dbh-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="local_mod.html#cb24-1" tabindex="-1"></a><span class="do">### plot</span></span>
<span id="cb24-2"><a href="local_mod.html#cb24-2" tabindex="-1"></a>plt_weib <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="local_mod.html#cb24-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="local_mod.html#cb24-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="local_mod.html#cb24-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb24-6"><a href="local_mod.html#cb24-6" tabindex="-1"></a>    treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="local_mod.html#cb24-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="local_mod.html#cb24-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb24-9"><a href="local_mod.html#cb24-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.15</span>)</span>
<span id="cb24-10"><a href="local_mod.html#cb24-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-11"><a href="local_mod.html#cb24-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb24-12"><a href="local_mod.html#cb24-12" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb24-13"><a href="local_mod.html#cb24-13" tabindex="-1"></a>      <span class="at">x=</span>tree_height_m, <span class="at">y =</span> mod_weib_est_dbh_cm</span>
<span id="cb24-14"><a href="local_mod.html#cb24-14" tabindex="-1"></a>      , <span class="at">color =</span> is_training_data</span>
<span id="cb24-15"><a href="local_mod.html#cb24-15" tabindex="-1"></a>      , <span class="at">fill =</span> is_training_data</span>
<span id="cb24-16"><a href="local_mod.html#cb24-16" tabindex="-1"></a>      , <span class="at">group =</span> is_training_data</span>
<span id="cb24-17"><a href="local_mod.html#cb24-17" tabindex="-1"></a>    )</span>
<span id="cb24-18"><a href="local_mod.html#cb24-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-19"><a href="local_mod.html#cb24-19" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb24-20"><a href="local_mod.html#cb24-20" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;loess&quot;</span></span>
<span id="cb24-21"><a href="local_mod.html#cb24-21" tabindex="-1"></a>    , <span class="at">se =</span> F</span>
<span id="cb24-22"><a href="local_mod.html#cb24-22" tabindex="-1"></a>    , <span class="at">span =</span> <span class="dv">1</span></span>
<span id="cb24-23"><a href="local_mod.html#cb24-23" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb24-24"><a href="local_mod.html#cb24-24" tabindex="-1"></a>    , <span class="at">show.legend =</span> T</span>
<span id="cb24-25"><a href="local_mod.html#cb24-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-26"><a href="local_mod.html#cb24-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb24-27"><a href="local_mod.html#cb24-27" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb24-28"><a href="local_mod.html#cb24-28" tabindex="-1"></a>    , <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb24-29"><a href="local_mod.html#cb24-29" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb24-30"><a href="local_mod.html#cb24-30" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb24-31"><a href="local_mod.html#cb24-31" tabindex="-1"></a>    , <span class="at">show.legend =</span> F</span>
<span id="cb24-32"><a href="local_mod.html#cb24-32" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb24-33"><a href="local_mod.html#cb24-33" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb24-34"><a href="local_mod.html#cb24-34" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)</span>
<span id="cb24-35"><a href="local_mod.html#cb24-35" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb24-36"><a href="local_mod.html#cb24-36" tabindex="-1"></a>      <span class="st">&quot;$DBH = </span><span class="sc">\\</span><span class="st">exp(&quot;</span></span>
<span id="cb24-37"><a href="local_mod.html#cb24-37" tabindex="-1"></a>      , mod_weib_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_a&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb24-38"><a href="local_mod.html#cb24-38" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">cdot (1-</span><span class="sc">\\</span><span class="st">exp(-Height/&quot;</span></span>
<span id="cb24-39"><a href="local_mod.html#cb24-39" tabindex="-1"></a>      , mod_weib_sum_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;b_b&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb24-40"><a href="local_mod.html#cb24-40" tabindex="-1"></a>      , <span class="st">&quot;)))$&quot;</span></span>
<span id="cb24-41"><a href="local_mod.html#cb24-41" tabindex="-1"></a>    ))</span>
<span id="cb24-42"><a href="local_mod.html#cb24-42" tabindex="-1"></a>    , <span class="at">parse =</span> T</span>
<span id="cb24-43"><a href="local_mod.html#cb24-43" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb24-44"><a href="local_mod.html#cb24-44" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-45"><a href="local_mod.html#cb24-45" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb24-46"><a href="local_mod.html#cb24-46" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>,<span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb24-47"><a href="local_mod.html#cb24-47" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>dbh_cm)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb24-48"><a href="local_mod.html#cb24-48" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(treetops_sf_with_dbh<span class="sc">$</span>tree_height_m)<span class="sc">*</span><span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb24-49"><a href="local_mod.html#cb24-49" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-50"><a href="local_mod.html#cb24-50" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb24-51"><a href="local_mod.html#cb24-51" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb24-52"><a href="local_mod.html#cb24-52" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;Nonlinear Weibull Model&quot;</span></span>
<span id="cb24-53"><a href="local_mod.html#cb24-53" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;SfM-derived tree height and DBH relationship&quot;</span></span>
<span id="cb24-54"><a href="local_mod.html#cb24-54" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb24-55"><a href="local_mod.html#cb24-55" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;Training Data&quot;</span></span>
<span id="cb24-56"><a href="local_mod.html#cb24-56" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-57"><a href="local_mod.html#cb24-57" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb24-58"><a href="local_mod.html#cb24-58" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-59"><a href="local_mod.html#cb24-59" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb24-60"><a href="local_mod.html#cb24-60" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb24-61"><a href="local_mod.html#cb24-61" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-62"><a href="local_mod.html#cb24-62" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb24-63"><a href="local_mod.html#cb24-63" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">6</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb24-64"><a href="local_mod.html#cb24-64" tabindex="-1"></a>  )</span>
<span id="cb24-65"><a href="local_mod.html#cb24-65" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb24-66"><a href="local_mod.html#cb24-66" tabindex="-1"></a>plt_weib</span></code></pre></div>
<p><img src="bhef_uas_202306_files/figure-html/plt-weib-1.png" width="1008" /></p>
</div>
</div>
<div id="model-comparison" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Model Comparison<a href="local_mod.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The pointwise log-likelihood can be used, among others, to calculate the leave-one-out cross-validation (LOO; <a href="https://scholar.google.com/scholar?cluster=13592897121719449855&amp;oi=gsb&amp;hl=en&amp;as_sdt=0,6">Vehtari, Gelman, and Gabry 2015</a>) allowing for comparison of different models applied to the same data (lower LOOs indicate better model fit).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="local_mod.html#cb25-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">loo_compare</span>(mod_lin, mod_quad, mod_quad_noint, mod_pwr, mod_weib, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="local_mod.html#cb25-2" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="local_mod.html#cb25-3" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mod_lin
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
-9143.944
</td>
<td style="text-align:right;">
32.486
</td>
<td style="text-align:right;">
2.557
</td>
<td style="text-align:right;">
0.109
</td>
<td style="text-align:right;">
18287.89
</td>
<td style="text-align:right;">
64.972
</td>
</tr>
<tr>
<td style="text-align:left;">
mod_pwr
</td>
<td style="text-align:right;">
-15.256
</td>
<td style="text-align:right;">
5.003
</td>
<td style="text-align:right;">
-9159.200
</td>
<td style="text-align:right;">
32.598
</td>
<td style="text-align:right;">
2.671
</td>
<td style="text-align:right;">
0.092
</td>
<td style="text-align:right;">
18318.40
</td>
<td style="text-align:right;">
65.196
</td>
</tr>
<tr>
<td style="text-align:left;">
mod_weib
</td>
<td style="text-align:right;">
-27.266
</td>
<td style="text-align:right;">
8.488
</td>
<td style="text-align:right;">
-9171.210
</td>
<td style="text-align:right;">
32.204
</td>
<td style="text-align:right;">
2.820
</td>
<td style="text-align:right;">
0.093
</td>
<td style="text-align:right;">
18342.42
</td>
<td style="text-align:right;">
64.409
</td>
</tr>
<tr>
<td style="text-align:left;">
mod_quad
</td>
<td style="text-align:right;">
-164.854
</td>
<td style="text-align:right;">
16.991
</td>
<td style="text-align:right;">
-9308.798
</td>
<td style="text-align:right;">
35.442
</td>
<td style="text-align:right;">
146.992
</td>
<td style="text-align:right;">
17.286
</td>
<td style="text-align:right;">
18617.60
</td>
<td style="text-align:right;">
70.885
</td>
</tr>
<tr>
<td style="text-align:left;">
mod_quad_noint
</td>
<td style="text-align:right;">
-405.877
</td>
<td style="text-align:right;">
36.401
</td>
<td style="text-align:right;">
-9549.820
</td>
<td style="text-align:right;">
39.550
</td>
<td style="text-align:right;">
5.555
</td>
<td style="text-align:right;">
0.918
</td>
<td style="text-align:right;">
19099.64
</td>
<td style="text-align:right;">
79.101
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="local_mod.html#cb26-1" tabindex="-1"></a><span class="co"># # can also check model weights</span></span>
<span id="cb26-2"><a href="local_mod.html#cb26-2" tabindex="-1"></a><span class="co"># brms::model_weights(mod_lin, mod_quad, mod_quad_noint, mod_pwr, mod_weib, weights = &quot;loo&quot;) %&gt;% </span></span>
<span id="cb26-3"><a href="local_mod.html#cb26-3" tabindex="-1"></a><span class="co">#   round(3)</span></span></code></pre></div>
<p>Based on these results, the linear model <span class="math inline">\(DBH_i = \beta_0 + \beta_1 \cdot Height_i\)</span> has the best fit among models tested. DBH estimates based on this model for trees where DBH could not be extracted from the UAS SfM data will be used in the following analysis and stand-level summaries</p>
</div>
<div id="update-dbh-to-best-model" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Update DBH to best model<a href="local_mod.html#update-dbh-to-best-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="local_mod.html#cb27-1" tabindex="-1"></a><span class="co"># update treetops</span></span>
<span id="cb27-2"><a href="local_mod.html#cb27-2" tabindex="-1"></a>treetops_sf_with_dbh <span class="ot">=</span> treetops_sf_with_dbh <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="local_mod.html#cb27-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb27-4"><a href="local_mod.html#cb27-4" tabindex="-1"></a>    <span class="at">mod_rf_est_dbh_cm =</span> dbh_cm</span>
<span id="cb27-5"><a href="local_mod.html#cb27-5" tabindex="-1"></a>    , <span class="at">dbh_cm =</span> mod_lin_est_dbh_cm</span>
<span id="cb27-6"><a href="local_mod.html#cb27-6" tabindex="-1"></a>    , <span class="at">dbh_m =</span> dbh_cm<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb27-7"><a href="local_mod.html#cb27-7" tabindex="-1"></a>    , <span class="at">radius_m =</span> dbh_m<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb27-8"><a href="local_mod.html#cb27-8" tabindex="-1"></a>    , <span class="at">basal_area_m2 =</span> pi <span class="sc">*</span> (radius_m)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-9"><a href="local_mod.html#cb27-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb27-10"><a href="local_mod.html#cb27-10" tabindex="-1"></a>  <span class="co"># convert to imperial units</span></span>
<span id="cb27-11"><a href="local_mod.html#cb27-11" tabindex="-1"></a>  <span class="fu">calc_imperial_units_fn</span>()</span>
<span id="cb27-12"><a href="local_mod.html#cb27-12" tabindex="-1"></a></span>
<span id="cb27-13"><a href="local_mod.html#cb27-13" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb27-14"><a href="local_mod.html#cb27-14" tabindex="-1"></a><span class="co"># update crowns</span></span>
<span id="cb27-15"><a href="local_mod.html#cb27-15" tabindex="-1"></a>crowns_sf_with_dbh <span class="ot">=</span> crowns_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="local_mod.html#cb27-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb27-17"><a href="local_mod.html#cb27-17" tabindex="-1"></a>    dbh_cm</span>
<span id="cb27-18"><a href="local_mod.html#cb27-18" tabindex="-1"></a>    , dbh_m</span>
<span id="cb27-19"><a href="local_mod.html#cb27-19" tabindex="-1"></a>    , radius_m</span>
<span id="cb27-20"><a href="local_mod.html#cb27-20" tabindex="-1"></a>    , basal_area_m2</span>
<span id="cb27-21"><a href="local_mod.html#cb27-21" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb27-22"><a href="local_mod.html#cb27-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb27-23"><a href="local_mod.html#cb27-23" tabindex="-1"></a>    treetops_sf_with_dbh <span class="sc">%&gt;%</span> </span>
<span id="cb27-24"><a href="local_mod.html#cb27-24" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-25"><a href="local_mod.html#cb27-25" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb27-26"><a href="local_mod.html#cb27-26" tabindex="-1"></a>        treeID</span>
<span id="cb27-27"><a href="local_mod.html#cb27-27" tabindex="-1"></a>        , dbh_cm</span>
<span id="cb27-28"><a href="local_mod.html#cb27-28" tabindex="-1"></a>        , dbh_m</span>
<span id="cb27-29"><a href="local_mod.html#cb27-29" tabindex="-1"></a>        , radius_m</span>
<span id="cb27-30"><a href="local_mod.html#cb27-30" tabindex="-1"></a>        , basal_area_m2</span>
<span id="cb27-31"><a href="local_mod.html#cb27-31" tabindex="-1"></a>        , (tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;mod_&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_cm&quot;</span>))</span>
<span id="cb27-32"><a href="local_mod.html#cb27-32" tabindex="-1"></a>      )</span>
<span id="cb27-33"><a href="local_mod.html#cb27-33" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(treeID)</span>
<span id="cb27-34"><a href="local_mod.html#cb27-34" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb27-35"><a href="local_mod.html#cb27-35" tabindex="-1"></a>  <span class="co"># convert to imperial units</span></span>
<span id="cb27-36"><a href="local_mod.html#cb27-36" tabindex="-1"></a>  <span class="fu">calc_imperial_units_fn</span>()</span>
<span id="cb27-37"><a href="local_mod.html#cb27-37" tabindex="-1"></a></span>
<span id="cb27-38"><a href="local_mod.html#cb27-38" tabindex="-1"></a><span class="do">## write data</span></span>
<span id="cb27-39"><a href="local_mod.html#cb27-39" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(treetops_sf_with_dbh, <span class="fu">paste0</span>(delivery_dir,<span class="st">&quot;/dbh_updated_detected_tree_tops.gpkg&quot;</span>), <span class="at">append =</span> F)</span>
<span id="cb27-40"><a href="local_mod.html#cb27-40" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(crowns_sf_with_dbh, <span class="fu">paste0</span>(delivery_dir,<span class="st">&quot;/dbh_updated_detected_crowns.gpkg&quot;</span>), <span class="at">append =</span> F)</span>
<span id="cb27-41"><a href="local_mod.html#cb27-41" tabindex="-1"></a></span>
<span id="cb27-42"><a href="local_mod.html#cb27-42" tabindex="-1"></a><span class="do">## keep the best model</span></span>
<span id="cb27-43"><a href="local_mod.html#cb27-43" tabindex="-1"></a>mod_best <span class="ot">=</span> mod_lin</span>
<span id="cb27-44"><a href="local_mod.html#cb27-44" tabindex="-1"></a>pred_mod_best <span class="ot">=</span> pred_mod_lin</span></code></pre></div>
</div>
<div id="combine-harvest-units-with-tree-locations" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Combine harvest units with tree locations<a href="local_mod.html#combine-harvest-units-with-tree-locations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Spatially combine harvest units with tree locations. One tree can be located in multiple harvest units if the harvest units spatially overlap; I’ll allow it. Trees are matched to a harvest unit based on the location of the tree top which may or may not align with the location of the tree bole at DBH.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="local_mod.html#cb28-1" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb28-2"><a href="local_mod.html#cb28-2" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb28-3"><a href="local_mod.html#cb28-3" tabindex="-1"></a><span class="co"># Join tree tops with forest stands</span></span>
<span id="cb28-4"><a href="local_mod.html#cb28-4" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb28-5"><a href="local_mod.html#cb28-5" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb28-6"><a href="local_mod.html#cb28-6" tabindex="-1"></a>harvests_trees <span class="ot">=</span> harvests <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="local_mod.html#cb28-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb28-8"><a href="local_mod.html#cb28-8" tabindex="-1"></a>    <span class="at">stand_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb28-9"><a href="local_mod.html#cb28-9" tabindex="-1"></a>    , <span class="at">stand_area_ha =</span> stand_area_m2<span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb28-10"><a href="local_mod.html#cb28-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href="local_mod.html#cb28-11" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(las_ctg_dta) <span class="sc">%&gt;%</span> </span>
<span id="cb28-12"><a href="local_mod.html#cb28-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb28-13"><a href="local_mod.html#cb28-13" tabindex="-1"></a>    <span class="at">intrsct_stand_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb28-14"><a href="local_mod.html#cb28-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-15"><a href="local_mod.html#cb28-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">round</span>(intrsct_stand_area_m2, <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">round</span>(stand_area_m2, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-16"><a href="local_mod.html#cb28-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb28-17"><a href="local_mod.html#cb28-17" tabindex="-1"></a>    suid, forest_commonname, admin_region_code, activity_name</span>
<span id="cb28-18"><a href="local_mod.html#cb28-18" tabindex="-1"></a>    , treatment_type, treatment_type_grp, date_compl, year_id</span>
<span id="cb28-19"><a href="local_mod.html#cb28-19" tabindex="-1"></a>    , stand_area_m2, stand_area_ha</span>
<span id="cb28-20"><a href="local_mod.html#cb28-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-21"><a href="local_mod.html#cb28-21" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(treetops_sf_with_dbh)</span>
<span id="cb28-22"><a href="local_mod.html#cb28-22" tabindex="-1"></a><span class="co"># filter harvests</span></span>
<span id="cb28-23"><a href="local_mod.html#cb28-23" tabindex="-1"></a>harvests <span class="ot">=</span> harvests <span class="sc">%&gt;%</span> </span>
<span id="cb28-24"><a href="local_mod.html#cb28-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(suid <span class="sc">%in%</span> <span class="fu">unique</span>(harvests_trees<span class="sc">$</span>suid))</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data_prep.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
